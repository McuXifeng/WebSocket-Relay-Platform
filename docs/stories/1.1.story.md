# Story 1.1: 初始化 Monorepo 项目结构与开发工具配置

## Status

**In Progress**

## Story

**As a** 开发者，
**I want** 初始化 Monorepo 项目结构并配置开发工具链，
**so that** 团队有统一的代码规范和高效的开发环境。

## Acceptance Criteria

1. 创建 Monorepo 根目录，使用 pnpm workspace 配置
2. 创建 `packages/frontend` 和 `packages/backend` 子项目目录
3. 配置 TypeScript（tsconfig.json），支持 ES2022 和严格模式
4. 配置 ESLint 和 Prettier，统一代码风格
5. 配置 Husky + lint-staged，Git commit 前自动运行代码检查
6. 创建 `.env.example` 文件，列出所有必需的环境变量
7. 创建根目录 `package.json`，包含常用脚本（`lint`, `format`, `test`）
8. 项目可以成功运行 `pnpm install` 并通过 lint 检查

## Tasks / Subtasks

- [x] **Task 1: 初始化 Monorepo 根目录和 pnpm workspace** (AC: 1, 2)
  - [x] 创建项目根目录 `websocket-relay-platform/`
  - [x] 创建 `pnpm-workspace.yaml` 文件，配置 packages 目录
  - [x] 创建 `packages/frontend/` 目录结构
  - [x] 创建 `packages/backend/` 目录结构
  - [x] 创建 `packages/shared/` 目录（用于共享类型和工具）

- [x] **Task 2: 配置根目录 package.json 和依赖** (AC: 7)
  - [x] 创建根目录 `package.json`，设置 name 为项目名
  - [x] 添加常用脚本：`dev`, `lint`, `format`, `test`
  - [x] 配置 `"private": true` 和 `"type": "module"`
  - [x] 安装根级别开发依赖：TypeScript, ESLint, Prettier, Husky, lint-staged

- [x] **Task 3: 配置 TypeScript** (AC: 3)
  - [x] 创建根目录 `tsconfig.json`，配置基础选项
  - [x] 设置 `target: "ES2022"`, `module: "ESNext"`
  - [x] 启用严格模式：`strict: true`, `strictNullChecks: true`
  - [x] 配置路径映射和模块解析
  - [x] 在 frontend 和 backend 子包中创建继承根配置的 tsconfig.json

- [x] **Task 4: 配置 ESLint 和 Prettier** (AC: 4)
  - [x] 创建 `.eslintrc.json`，配置 TypeScript 规则
  - [x] 配置 ESLint 插件：`@typescript-eslint/parser`, `@typescript-eslint/eslint-plugin`
  - [x] 创建 `.prettierrc`，配置代码格式化规则
  - [x] 创建 `.eslintignore` 和 `.prettierignore`，排除 node_modules 和 dist
  - [x] 在根 package.json 中添加 lint 和 format 脚本

- [x] **Task 5: 配置 Husky 和 lint-staged** (AC: 5)
  - [x] 安装 Husky 8.x 和 lint-staged 15.x
  - [x] 运行 `npx husky install` 初始化 Husky
  - [x] 创建 `.husky/pre-commit` hook，运行 `npx lint-staged`
  - [x] 在 package.json 中配置 lint-staged，对 TypeScript 文件运行 ESLint 和 Prettier
  - [x] 配置 package.json 的 prepare script 为 `husky install`

- [x] **Task 6: 创建环境变量模板** (AC: 6)
  - [x] 创建根目录 `.env.example` 文件
  - [x] 添加前端环境变量示例：`VITE_API_URL`, `VITE_WS_URL`
  - [x] 添加后端环境变量示例：`DATABASE_URL`, `JWT_SECRET`, `JWT_EXPIRES_IN`, `API_PORT`, `WS_PORT`, `ALLOWED_ORIGINS`, `LOG_LEVEL`
  - [x] 为每个环境变量添加注释说明用途

- [x] **Task 7: 创建基础文档和 README** (AC: 8)
  - [x] 创建 `README.md`，包含项目简介和快速开始指南
  - [x] 创建 `docs/` 目录
  - [x] 添加 `.gitignore`，排除 node_modules, dist, .env

- [ ] **Task 8: 验证配置和安装** (AC: 8)
  - [ ] 运行 `pnpm install` 安装所有依赖
  - [ ] 运行 `pnpm lint` 验证 ESLint 配置正确
  - [ ] 运行 `pnpm format` 验证 Prettier 配置正确
  - [ ] 创建测试文件并提交，验证 Husky pre-commit hook 正常工作

## Dev Notes

### Previous Story Insights

这是项目的第一个故事，没有之前的故事上下文。

### Project Structure

项目采用 **Monorepo** 架构，使用 **pnpm workspace** 管理多个包。

**目标项目结构：**
```
websocket-relay-platform/
├── .github/
│   └── workflows/
├── packages/
│   ├── frontend/               # React 前端
│   │   ├── public/
│   │   ├── src/
│   │   ├── package.json
│   │   ├── tsconfig.json
│   │   └── vite.config.ts
│   ├── backend/                # Express + WebSocket 后端
│   │   ├── src/
│   │   │   ├── routes/
│   │   │   ├── controllers/
│   │   │   ├── services/
│   │   │   ├── middleware/
│   │   │   ├── websocket/
│   │   │   ├── prisma/
│   │   │   ├── app.ts
│   │   │   ├── server.ts
│   │   │   └── ws-server.ts
│   │   ├── tests/
│   │   ├── package.json
│   │   └── tsconfig.json
│   └── shared/                 # 共享类型和工具
│       ├── src/
│       │   ├── types/
│       │   └── utils/
│       └── package.json
├── infrastructure/
├── docs/
├── .env.example
├── .eslintrc.json
├── .prettierrc
├── package.json
├── pnpm-workspace.yaml
└── README.md
```

[Source: architecture/unified-project-structure.md]

### Tech Stack Configuration

**包管理器：**
- **pnpm 8.x** - 磁盘空间节省，安装速度快，Monorepo workspace 支持良好
- [Source: architecture/tech-stack.md#Technology Stack Table]

**开发语言：**
- **TypeScript 5.3+** - 前后端统一使用，类型安全开发，减少运行时错误
- 配置要求：支持 ES2022 和严格模式
- [Source: architecture/tech-stack.md#Technology Stack Table]

**代码质量工具：**
- **ESLint 8.x** - JavaScript/TypeScript 代码检查，统一代码风格，捕获潜在错误
- **Prettier 3.x** - 代码自动格式化，团队风格统一
- **Husky 8.x + lint-staged 15.x** - Git commit 前自动运行 lint 和 format，保证提交代码质量
- [Source: architecture/tech-stack.md#Technology Stack Table]

### Environment Variables

根据项目需求，需要配置以下环境变量类别：

**前端环境变量 (.env.local)：**
```bash
VITE_API_URL=http://localhost:3000/api
VITE_WS_URL=ws://localhost:3001
```
[Source: architecture/development-workflow.md#Environment Configuration]

**后端环境变量 (.env)：**
```bash
# 数据库
DATABASE_URL="mysql://user:password@localhost:3306/websocket_relay"

# JWT
JWT_SECRET=your-super-secret-key-change-in-production
JWT_EXPIRES_IN=7d

# 服务器端口
API_PORT=3000
WS_PORT=3001

# CORS
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000

# WebSocket
WS_BASE_URL=ws://localhost:3001

# 日志
LOG_LEVEL=debug
```
[Source: architecture/development-workflow.md#Environment Configuration]

### Coding Standards

**关键全栈规则：**
- **类型共享：** 所有共享类型定义在 `packages/shared/src/types`，前后端统一导入
- **环境变量：** 通过 `config/` 模块访问环境变量，禁止直接使用 `process.env`
- [Source: architecture/coding-standards.md#Critical Fullstack Rules]

**命名约定：**
- Components: PascalCase（如 `UserProfile.tsx`）
- Hooks: camelCase with 'use'（如 `useAuth.ts`）
- Functions: camelCase（如 `getUserById()`）
- Constants: UPPER_SNAKE_CASE（如 `MAX_ENDPOINTS`）
- [Source: architecture/coding-standards.md#Naming Conventions]

### Development Workflow

**前置条件：**
- Node.js 20.x LTS
- pnpm（通过 `npm install -g pnpm` 安装）
- MySQL 8.0
- [Source: architecture/development-workflow.md#Prerequisites]

**开发命令：**
```bash
# 安装依赖
pnpm install

# 启动所有服务（开发模式）
pnpm dev

# 代码检查
pnpm lint

# 代码格式化
pnpm format

# 运行测试
pnpm test
```
[Source: architecture/development-workflow.md#Development Commands]

### File Locations

此故事需要在项目根目录创建以下文件：
- `pnpm-workspace.yaml` - Workspace 配置
- `package.json` - 根目录包配置
- `tsconfig.json` - TypeScript 基础配置
- `.eslintrc.json` - ESLint 配置
- `.prettierrc` - Prettier 配置
- `.env.example` - 环境变量模板
- `.gitignore` - Git 忽略文件配置
- `README.md` - 项目文档

需要创建的目录结构：
- `packages/frontend/` - 前端项目目录
- `packages/backend/` - 后端项目目录
- `packages/shared/` - 共享代码目录
- `docs/` - 文档目录
- `.husky/` - Git hooks 目录

### Technical Constraints

**TypeScript 配置要求：**
- target: ES2022
- 严格模式启用
- [Source: architecture/tech-stack.md#Technology Stack Table]

**pnpm Workspace 配置：**
- 必须在 `pnpm-workspace.yaml` 中声明 packages 路径
- 子包通过 workspace 协议相互引用
- [Source: architecture/unified-project-structure.md]

### Testing

**测试策略概述：**
此故事主要涉及项目配置，不需要单元测试代码，但需要验证配置的正确性。

**验证方式：**
1. 运行 `pnpm install` 确保依赖安装成功
2. 运行 `pnpm lint` 确保 ESLint 配置正确
3. 运行 `pnpm format` 确保 Prettier 配置正确
4. 创建测试文件并尝试提交，验证 Husky pre-commit hook 能够触发 lint-staged

**测试文件位置（未来故事参考）：**
- 后端测试：`packages/backend/tests/`
- 前端测试：`packages/frontend/src/__tests__/`
- [Source: architecture/testing-strategy.md#Test Organization]

**测试框架（未来故事使用）：**
- 后端：Jest 29.x
- 前端：Vitest 1.x
- [Source: architecture/tech-stack.md#Technology Stack Table]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-27 | 1.0 | 初始创建故事 1.1 | Bob (Scrum Master) |

## Dev Agent Record

_此部分由开发代理在实施过程中填充_

### Agent Model Used

_待填充_

### Debug Log References

_待填充_

### Completion Notes List

_待填充_

### File List

_待填充_

## QA Results

_此部分由 QA 代理在完成故事实施的 QA 审查后填充_
