# Story 6.2 手动测试指南

## 概述

本文档提供Story 6.2（实时数据流可视化 - 图表展示）的完整手动测试指南。

**测试环境要求:**
- ✅ 后端服务已启动 (`pnpm --filter @websocket-relay/backend dev`)
- ✅ 前端服务已启动 (`pnpm --filter @websocket-relay/frontend dev`)
- ✅ 数据库已初始化并运行
- ✅ 已有测试账号和测试端点
- ✅ 已有设备历史数据（可使用`test-device-data-upload.mjs`脚本上传）

---

## Task 9.3: 前端手动测试 - 图表所有交互功能

### 测试准备

1. **登录系统**
   ```
   访问: http://localhost:5173
   使用测试账号登录
   ```

2. **准备测试数据**
   ```bash
   # 上传一些历史数据（如果还没有）
   node test-device-data-upload.mjs
   ```

### 测试用例列表

#### TC 9.3.1: 创建折线图卡片

**步骤:**
1. 访问可视化Dashboard页面: `http://localhost:5173/visualization`
2. 点击"添加卡片"按钮
3. 填写卡片配置:
   - **卡片类型:** 选择 "折线图"
   - **端点:** 选择测试端点
   - **设备:** 选择设备（多个数据源的第一个）
   - **数据字段:** 选择 "temperature"
   - **标题:** 输入 "设备温度趋势"
   - **图表类型:** 选择 "折线图"
   - **时间范围类型:** 选择 "快捷选项"
   - **快捷时间范围:** 选择 "最近24小时"
   - **数据源:** 添加至少1个设备的数据源
4. 点击"保存"按钮

**预期结果:**
- ✅ 卡片成功创建，出现在Dashboard上
- ✅ 图表显示正确的数据曲线
- ✅ 图表标题显示为"设备温度趋势"
- ✅ x轴显示时间轴，y轴显示数值和单位
- ✅ 图例显示设备名称和数据字段

#### TC 9.3.2: 创建柱状图卡片

**步骤:**
1. 点击"添加卡片"按钮
2. 填写卡片配置:
   - **卡片类型:** 选择 "柱状图"
   - **端点:** 选择测试端点
   - **设备:** 选择设备
   - **数据字段:** 选择 "humidity"
   - **标题:** 输入 "设备湿度分布"
   - **图表类型:** 选择 "柱状图"
   - **时间范围类型:** 选择 "快捷选项"
   - **快捷时间范围:** 选择 "最近1小时"
3. 点击"保存"按钮

**预期结果:**
- ✅ 柱状图卡片成功创建
- ✅ 图表以柱状图形式展示数据
- ✅ 柱状图颜色清晰可见

#### TC 9.3.3: 时间范围选择器（自定义时间范围）

**步骤:**
1. 编辑已存在的图表卡片（点击编辑按钮）
2. 修改时间范围配置:
   - **时间范围类型:** 选择 "自定义"
   - **自定义时间范围:** 选择一个具体的时间段（如今天上午9点到下午5点）
3. 点击"保存"按钮

**预期结果:**
- ✅ 图表数据重新加载
- ✅ 显示自定义时间范围内的数据
- ✅ x轴时间范围与配置一致

#### TC 9.3.4: 多设备数据对比

**步骤:**
1. 编辑折线图卡片
2. 在"数据源"部分添加多个设备:
   - 点击"添加数据源"按钮
   - 选择不同的设备和数据字段
   - 为每个数据源设置不同的颜色
3. 点击"保存"按钮

**预期结果:**
- ✅ 图表显示多条曲线（不同颜色）
- ✅ 图例显示所有设备的标签
- ✅ 可以点击图例切换曲线的显示/隐藏
- ✅ 不同曲线颜色与配置一致

#### TC 9.3.5: 图表交互功能 - 缩放

**步骤:**
1. 将鼠标移动到图表区域
2. 使用鼠标滚轮向前滚动（放大）
3. 使用鼠标滚轮向后滚动（缩小）
4. 或使用图表工具栏的缩放工具

**预期结果:**
- ✅ 图表能够放大和缩小
- ✅ 缩放操作流畅，无卡顿
- ✅ 缩放后数据点清晰可见

#### TC 9.3.6: 图表交互功能 - 平移

**步骤:**
1. 在图表区域按住鼠标左键拖动
2. 尝试向左、向右平移

**预期结果:**
- ✅ 图表能够平移查看不同时间段的数据
- ✅ 平移操作流畅

#### TC 9.3.7: 图表交互功能 - 悬停提示

**步骤:**
1. 将鼠标移动到图表上的数据点上
2. 悬停几秒钟

**预期结果:**
- ✅ 出现悬停提示框
- ✅ 提示框显示：时间戳、数值、单位
- ✅ 提示框内容清晰易读

#### TC 9.3.8: 实时数据流更新

**步骤:**
1. 确保图表配置了"刷新间隔"（默认5秒）
2. 上传新的设备数据:
   ```bash
   node test-device-data-upload.mjs
   ```
3. 等待5秒，观察图表变化

**预期结果:**
- ✅ 图表自动刷新
- ✅ 新数据追加到图表末尾
- ✅ 数据更新流畅，无闪烁

#### TC 9.3.9: 拖拽调整图表卡片

**步骤:**
1. 点击图表卡片的标题栏（拖拽手柄区域）
2. 拖动卡片到Dashboard的不同位置
3. 调整卡片的大小（拖动右下角）

**预期结果:**
- ✅ 卡片能够拖拽移动
- ✅ 卡片能够调整大小
- ✅ 图表尺寸自适应卡片大小
- ✅ 图表内容重新渲染，保持清晰

#### TC 9.3.10: 刷新页面后配置保留

**步骤:**
1. 创建或编辑一个图表卡片
2. 刷新浏览器页面（F5）
3. 再次访问可视化Dashboard

**预期结果:**
- ✅ 图表卡片仍然存在
- ✅ 图表配置保持不变（时间范围、数据源、样式等）
- ✅ 图表数据正确加载

#### TC 9.3.11: 编辑图表卡片

**步骤:**
1. 点击图表卡片的"编辑"按钮
2. 修改配置（例如：更换数据源、调整时间范围）
3. 点击"保存"按钮

**预期结果:**
- ✅ 配置弹窗显示当前配置
- ✅ 修改后图表立即更新
- ✅ 更新后的数据符合新配置

#### TC 9.3.12: 删除图表卡片

**步骤:**
1. 点击图表卡片的"删除"按钮
2. 确认删除操作

**预期结果:**
- ✅ 卡片从Dashboard中移除
- ✅ 刷新页面后卡片不再出现

#### TC 9.3.13: 图表工具栏功能

**步骤:**
1. 点击图表工具栏的"导出图片"按钮
2. 点击"还原"按钮（重置缩放和平移）

**预期结果:**
- ✅ 图片成功导出到本地
- ✅ 还原按钮将图表重置为初始状态

---

## Task 9.4: 性能测试 - 验证图表加载时间 < 2秒

### 测试方法

1. **打开浏览器开发者工具**
   - 按 F12 打开开发者工具
   - 切换到 "Network" 标签
   - 勾选 "Disable cache"

2. **测试图表初始加载性能**

   **步骤:**
   1. 清空浏览器缓存
   2. 访问可视化Dashboard页面: `http://localhost:5173/visualization`
   3. 记录页面完全加载的时间
   4. 创建一个新的图表卡片（折线图，最近24小时，包含1000个数据点）
   5. 在 Network 标签中找到历史数据查询API请求
   6. 记录以下时间:
      - **API响应时间:** Network面板显示的请求时间
      - **图表渲染时间:** 从API响应到图表完全渲染的时间
      - **总加载时间:** API响应时间 + 图表渲染时间

   **性能要求:**
   - ✅ API响应时间 < 1秒
   - ✅ 图表渲染时间 < 1秒
   - ✅ **总加载时间 < 2秒** ⭐

3. **测试不同数据量的性能**

   测试以下场景并记录加载时间:

   | 场景 | 时间范围 | 聚合方式 | 预期数据点 | 要求加载时间 |
   |------|----------|----------|-----------|------------|
   | 场景1 | 最近1小时 | 按分钟 | ~60点 | < 1秒 |
   | 场景2 | 最近24小时 | 按小时 | ~24点 | < 1秒 |
   | 场景3 | 最近7天 | 按小时 | ~168点 | < 2秒 |
   | 场景4 | 自定义(大范围) | 按天 | ~30点 | < 2秒 |

4. **性能瓶颈分析（如果加载时间 > 2秒）**

   使用Chrome DevTools Performance标签分析性能瓶颈:
   1. 切换到 Performance 标签
   2. 点击"录制"按钮
   3. 创建图表卡片
   4. 停止录制
   5. 分析火焰图，找出性能瓶颈:
      - 后端API响应慢？→ 检查SQL查询性能
      - 前端渲染慢？→ 检查ECharts配置和数据处理

---

## Task 9.5: 性能测试 - 验证实时数据流更新流畅性

### 测试方法

1. **打开浏览器开发者工具**
   - 按 F12 打开开发者工具
   - 切换到 "Performance" 标签
   - 勾选 "Screenshots"

2. **测试实时数据流更新性能**

   **步骤:**
   1. 创建一个图表卡片（配置刷新间隔为5秒）
   2. 开始录制 Performance
   3. 运行数据上传脚本（模拟新数据）:
      ```bash
      node test-device-data-upload.mjs
      ```
   4. 等待10秒（2次数据刷新）
   5. 停止录制

   **性能指标:**
   - ✅ **帧率 (Frame Rate) > 30fps** ⭐
   - ✅ 数据更新无明显卡顿
   - ✅ CPU使用率 < 80%
   - ✅ 内存使用平稳，无内存泄漏

3. **长时间运行稳定性测试**

   **步骤:**
   1. 创建2-3个图表卡片（不同设备和数据源）
   2. 保持页面运行30分钟
   3. 每5分钟上传一次新数据
   4. 观察以下指标:
      - 页面响应速度
      - 浏览器内存占用（打开 Performance Monitor）
      - 是否有JavaScript错误

   **稳定性要求:**
   - ✅ 页面持续响应，无卡死
   - ✅ 内存占用稳定，无持续增长
   - ✅ 无JavaScript错误或警告

---

## Task 9.6: 端到端测试 - 完整用户操作流程

### 测试场景: 从零开始创建IoT设备数据可视化Dashboard

**目标:** 验证用户能够从登录到查看实时图表的完整流程

### 测试步骤

#### Step 1: 用户登录

1. 访问登录页面: `http://localhost:5173/login`
2. 输入用户名和密码
3. 点击"登录"按钮

**验证:**
- ✅ 成功跳转到Dashboard页面或主页

---

#### Step 2: 创建端点（如果没有）

1. 访问端点管理页面
2. 点击"创建端点"按钮
3. 填写端点名称
4. 保存端点

**验证:**
- ✅ 端点成功创建
- ✅ 获得WebSocket连接URL

---

#### Step 3: 连接设备并上传数据

1. 使用WebSocket客户端连接到端点
2. 上传设备数据:
   ```bash
   node test-device-data-upload.mjs
   ```

**验证:**
- ✅ 设备成功注册
- ✅ 数据成功存储到数据库
- ✅ 在端点详情页可以看到设备和最新数据

---

#### Step 4: 访问可视化Dashboard

1. 点击导航栏的"数据可视化"链接
2. 访问 `/visualization` 页面

**验证:**
- ✅ 页面加载成功
- ✅ 显示空的Dashboard或已有的卡片

---

#### Step 5: 创建第一个图表卡片（折线图）

1. 点击"添加卡片"按钮
2. 选择卡片类型: "折线图"
3. 选择端点和设备
4. 配置数据源:
   - 设备: 选择刚才上传数据的设备
   - 数据字段: "temperature"
   - 曲线标签: "设备A - 温度"
   - 颜色: 蓝色
5. 配置时间范围: "最近24小时"
6. 配置图表标题: "设备温度趋势"
7. 点击"保存"

**验证:**
- ✅ 图表卡片出现在Dashboard上
- ✅ 图表显示温度数据曲线
- ✅ x轴显示时间，y轴显示温度值和单位（°C）
- ✅ 图例显示"设备A - 温度"

---

#### Step 6: 添加第二个图表卡片（柱状图）

1. 点击"添加卡片"按钮
2. 选择卡片类型: "柱状图"
3. 配置数据源: 选择 "humidity" 字段
4. 配置时间范围: "最近1小时"
5. 配置图表标题: "设备湿度分布"
6. 点击"保存"

**验证:**
- ✅ 柱状图卡片成功创建
- ✅ 柱状图显示湿度数据分布

---

#### Step 7: 调整图表布局

1. 拖拽第一个图表卡片到左上角
2. 拖拽第二个图表卡片到右上角
3. 调整卡片大小，使其并排显示

**验证:**
- ✅ 卡片能够自由拖拽和调整大小
- ✅ 图表自适应卡片尺寸
- ✅ 布局美观，没有重叠

---

#### Step 8: 编辑图表配置

1. 点击第一个图表的"编辑"按钮
2. 添加第二个数据源:
   - 设备: 选择同一设备
   - 数据字段: "humidity"
   - 曲线标签: "设备A - 湿度"
   - 颜色: 绿色
3. 点击"保存"

**验证:**
- ✅ 图表更新为双曲线图
- ✅ 显示温度和湿度两条曲线
- ✅ 图例显示两个标签
- ✅ 曲线颜色与配置一致

---

#### Step 9: 测试实时数据更新

1. 保持Dashboard页面打开
2. 在终端运行数据上传脚本:
   ```bash
   node test-device-data-upload.mjs
   ```
3. 等待5-10秒

**验证:**
- ✅ 图表自动刷新
- ✅ 新数据追加到图表末尾
- ✅ 图表曲线平滑延伸

---

#### Step 10: 测试图表交互功能

1. **缩放测试:**
   - 使用鼠标滚轮放大/缩小图表
   - 验证: ✅ 缩放流畅

2. **平移测试:**
   - 拖动图表查看不同时间段
   - 验证: ✅ 平移流畅

3. **悬停提示:**
   - 鼠标悬停在数据点上
   - 验证: ✅ 显示时间戳、数值、单位

4. **图例交互:**
   - 点击图例切换曲线显示/隐藏
   - 验证: ✅ 曲线正确切换

---

#### Step 11: 刷新页面验证持久化

1. 按F5刷新浏览器
2. 页面重新加载

**验证:**
- ✅ 所有图表卡片仍然存在
- ✅ 图表配置保持不变
- ✅ 图表数据正确加载
- ✅ 布局位置保持不变

---

#### Step 12: 删除图表卡片

1. 点击第二个图表的"删除"按钮
2. 确认删除

**验证:**
- ✅ 图表卡片从Dashboard移除
- ✅ 其他卡片不受影响

---

### 端到端测试总结

完成以上所有步骤后，验证以下整体目标:

1. ✅ **功能完整性:** 所有核心功能正常工作
2. ✅ **性能达标:** 图表加载时间 < 2秒，实时更新流畅
3. ✅ **用户体验:** 操作流畅，界面友好，反馈及时
4. ✅ **数据准确性:** 图表显示的数据与数据库数据一致
5. ✅ **稳定性:** 长时间运行无崩溃，无内存泄漏
6. ✅ **跨浏览器兼容性:** 在Chrome、Firefox、Safari测试通过

---

## 测试完成标准

### Task 9.3: 前端手动测试

- ✅ 所有13个测试用例全部通过
- ✅ 所有交互功能正常工作
- ✅ 无UI Bug或异常行为

### Task 9.4: 性能测试 - 图表加载时间

- ✅ **总加载时间 < 2秒** （AC: 10）
- ✅ 所有测试场景满足性能要求
- ✅ 性能分析报告已生成（如果需要）

### Task 9.5: 性能测试 - 实时数据流

- ✅ **帧率 > 30fps** （AC: 4, 10）
- ✅ 数据更新流畅无卡顿
- ✅ 长时间运行稳定性测试通过

### Task 9.6: 端到端测试

- ✅ 完整用户操作流程（12个步骤）全部通过
- ✅ 功能、性能、用户体验、稳定性全部达标

---

## 测试报告模板

测试完成后，请填写以下测试报告:

```markdown
# Story 6.2 手动测试报告

## 测试环境
- 操作系统: [macOS / Windows / Linux]
- 浏览器: [Chrome / Firefox / Safari]
- 浏览器版本: [版本号]
- 测试日期: [YYYY-MM-DD]

## Task 9.3: 前端手动测试
- ✅ 通过用例数: [X/13]
- ❌ 失败用例数: [X/13]
- 失败用例详情:
  - [TC编号]: [失败原因]

## Task 9.4: 性能测试 - 图表加载时间
- ✅ API响应时间: [X]ms
- ✅ 图表渲染时间: [X]ms
- ✅ 总加载时间: [X]ms （要求 < 2000ms）
- 性能瓶颈: [无 / 描述]

## Task 9.5: 性能测试 - 实时数据流
- ✅ 帧率: [X]fps （要求 > 30fps）
- ✅ CPU使用率: [X]% （峰值）
- ✅ 内存使用: [X]MB （稳定/增长）
- 长时间运行稳定性: [通过 / 失败]

## Task 9.6: 端到端测试
- ✅ 通过步骤数: [X/12]
- ❌ 失败步骤数: [X/12]
- 失败步骤详情:
  - [Step编号]: [失败原因]

## 总体评价
- 功能完整性: [优秀 / 良好 / 需改进]
- 性能表现: [优秀 / 良好 / 需改进]
- 用户体验: [优秀 / 良好 / 需改进]
- 稳定性: [优秀 / 良好 / 需改进]

## 发现的问题
1. [问题描述]
2. [问题描述]

## 改进建议
1. [建议描述]
2. [建议描述]

## 测试结论
[通过 / 部分通过 / 失败]
```

---

## 附录: 测试数据准备脚本

### 上传历史数据

```bash
# 上传少量测试数据（用于快速测试）
node test-device-data-upload.mjs

# 批量上传大量历史数据（用于性能测试）
for i in {1..10}; do
  node test-device-data-upload.mjs
  sleep 2
done
```

### 清理测试数据

```bash
# 连接到MySQL数据库
mysql -u root -p websocket_relay

# 清理设备数据
DELETE FROM device_data WHERE device_id = 'your-test-device-id';

# 清理可视化卡片
DELETE FROM visualization_cards WHERE user_id = 'your-test-user-id';
```

---

**祝测试顺利！** φ(≧ω≦*)♪
