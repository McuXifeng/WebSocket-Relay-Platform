# Story 4.7: åˆ›å»º Nginx é…ç½®å’Œéƒ¨ç½²æ–‡æ¡£

## Status

**Ready for Review**

## Story

**As a** DevOps å·¥ç¨‹å¸ˆï¼Œ
**I want** é…ç½® Nginx åå‘ä»£ç†å’Œ SSLï¼Œ
**so that** åº”ç”¨å¯ä»¥é€šè¿‡ HTTPS/WSS å®‰å…¨è®¿é—®ã€‚

## Acceptance Criteria

1. åˆ›å»º `nginx.conf` é…ç½®æ–‡ä»¶æ¨¡æ¿
2. é…ç½®åå‘ä»£ç†:
   - `/` â†’ React é™æ€æ–‡ä»¶
   - `/api` â†’ Express API (http://localhost:3000)
   - `/ws` â†’ WebSocket æœåŠ¡å™¨ (http://localhost:3001ï¼Œé…ç½® WebSocket å‡çº§)
3. é…ç½® SSL/TLS (ä½¿ç”¨ Let's Encrypt)
4. é…ç½® HTTPS å¼ºåˆ¶é‡å®šå‘
5. é…ç½® CORS å¤´ (å¦‚æœéœ€è¦)
6. é…ç½® Gzip å‹ç¼©
7. åˆ›å»ºéƒ¨ç½²æ–‡æ¡£ `docs/deployment.md`ï¼ŒåŒ…å«:
   - æœåŠ¡å™¨è¦æ±‚ (2æ ¸4Gï¼ŒUbuntu 20.04+)
   - å®‰è£… Node.jsã€MySQLã€Nginxã€PM2
   - å…‹éš†ä»£ç ã€å®‰è£…ä¾èµ–
   - é…ç½®ç¯å¢ƒå˜é‡
   - è¿è¡Œæ•°æ®åº“è¿ç§»
   - æ„å»ºå‰ç«¯
   - é…ç½® Nginx
   - å¯åŠ¨ PM2
   - é…ç½® Let's Encrypt SSL
8. æ–‡æ¡£åŒ…å«å®Œæ•´çš„å‘½ä»¤æ­¥éª¤ï¼Œå¤åˆ¶å³å¯æ‰§è¡Œ

## Tasks / Subtasks

- [x] **Task 1: åˆ›å»º Nginx é…ç½®ç›®å½•ç»“æ„** (AC: 1)
  - [x] åˆ›å»º `infrastructure/nginx/` ç›®å½•ï¼ˆä¸ PM2 é…ç½®ç›®å½•å¹³çº§ï¼‰
  - [x] éªŒè¯ç›®å½•ç»“æ„ä¸æ¶æ„æ–‡æ¡£ä¸€è‡´ [Source: architecture/unified-project-structure.md]

- [x] **Task 2: åˆ›å»º Nginx ä¸»é…ç½®æ–‡ä»¶** (AC: 1, 2, 3, 4, 6)
  - [x] åˆ›å»º `infrastructure/nginx/nginx.conf` é…ç½®æ–‡ä»¶
  - [x] é…ç½® HTTP (ç«¯å£ 80) åˆ° HTTPS (ç«¯å£ 443) çš„å¼ºåˆ¶é‡å®šå‘
  - [x] é…ç½® SSL/TLS è¯ä¹¦è·¯å¾„ (Let's Encrypt æ ‡å‡†è·¯å¾„)
  - [x] é…ç½®å‰ç«¯é™æ€æ–‡ä»¶æœåŠ¡ (location `/`)
    - `root` æŒ‡å‘å‰ç«¯æ„å»ºäº§ç‰©ç›®å½•
    - `try_files $uri $uri/ /index.html` æ”¯æŒ React Router
  - [x] é…ç½® REST API åå‘ä»£ç† (location `/api/`)
    - `proxy_pass http://localhost:3000/api/`
    - è®¾ç½®å¿…è¦çš„ä»£ç†å¤´ (`Host`, `X-Real-IP`, `X-Forwarded-For`)
  - [x] é…ç½® WebSocket åå‘ä»£ç† (location `/ws/`)
    - `proxy_pass http://localhost:3001/ws/`
    - è®¾ç½® WebSocket å‡çº§å¤´ (`Upgrade`, `Connection "upgrade"`)
    - è®¾ç½® `proxy_http_version 1.1`
  - [x] é…ç½® Gzip å‹ç¼©
    - å¯ç”¨ `gzip on`
    - é…ç½®å‹ç¼©ç±»å‹ (`text/plain`, `text/css`, `application/json`, `application/javascript`)
  - [x] åŸºäºæ¶æ„æ–‡æ¡£çš„ Nginx é…ç½®æ¨¡æ¿ [Source: architecture/deployment-architecture.md#nginx-configuration]

- [x] **Task 3: åˆ›å»º Nginx é…ç½®æ³¨é‡Šç‰ˆæœ¬** (AC: 1)
  - [x] åˆ›å»º `infrastructure/nginx/nginx.conf.annotated` å¸¦è¯¦ç»†æ³¨é‡Šçš„é…ç½®æ–‡ä»¶
  - [x] ä¸ºæ¯ä¸ªé…ç½®å—æ·»åŠ ä¸­æ–‡è¯´æ˜æ³¨é‡Š
  - [x] è§£é‡Šå…³é”®é…ç½®é¡¹çš„ä½œç”¨å’Œå¯é€‰å‚æ•°
  - [x] æ·»åŠ æ€§èƒ½è°ƒä¼˜å»ºè®®æ³¨é‡Š

- [x] **Task 4: åˆ›å»ºéƒ¨ç½²æ–‡æ¡£ä¸»æ–‡ä»¶** (AC: 7)
  - [x] åˆ›å»º `docs/deployment.md` éƒ¨ç½²æ–‡æ¡£
  - [x] åŒ…å«æ–‡æ¡£ç›®å½•ç»“æ„ (Table of Contents)
  - [x] æ·»åŠ æ–‡æ¡£ç‰ˆæœ¬å·å’Œæœ€åæ›´æ–°æ—¶é—´

- [x] **Task 5: ç¼–å†™æœåŠ¡å™¨è¦æ±‚ç« èŠ‚** (AC: 7)
  - [x] åˆ—å‡ºæœåŠ¡å™¨ç¡¬ä»¶è¦æ±‚ (2æ ¸4G æœ€å°é…ç½®ï¼Œ4æ ¸8G æ¨èé…ç½®)
  - [x] åˆ—å‡ºæ“ä½œç³»ç»Ÿè¦æ±‚ (Ubuntu 20.04+, Debian 11+, CentOS 8+)
  - [x] åˆ—å‡ºå¿…éœ€è½¯ä»¶å’Œç‰ˆæœ¬:
    - Node.js 20.x LTS
    - MySQL 8.0+
    - Nginx 1.24+
    - PM2 5.x
    - pnpm 8.x
    - Git 2.x
  - [x] åˆ—å‡ºç½‘ç»œè¦æ±‚ (å¼€æ”¾ç«¯å£ 80, 443, 3000, 3001)
  - [x] åŸºäºæ¶æ„æ–‡æ¡£çš„æŠ€æœ¯æ ˆè¦æ±‚ [Source: architecture/tech-stack.md]

- [x] **Task 6: ç¼–å†™ç¯å¢ƒå‡†å¤‡ç« èŠ‚** (AC: 7)
  - [x] ç¼–å†™ Node.js å®‰è£…æ­¥éª¤
    ```bash
    curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
    sudo apt-get install -y nodejs
    ```
  - [x] ç¼–å†™ pnpm å®‰è£…æ­¥éª¤
    ```bash
    npm install -g pnpm
    ```
  - [x] ç¼–å†™ MySQL å®‰è£…å’Œé…ç½®æ­¥éª¤
    ```bash
    sudo apt-get install mysql-server
    sudo mysql_secure_installation
    ```
  - [x] ç¼–å†™ Nginx å®‰è£…æ­¥éª¤
    ```bash
    sudo apt-get install nginx
    ```
  - [x] ç¼–å†™ PM2 å…¨å±€å®‰è£…æ­¥éª¤
    ```bash
    npm install -g pm2
    ```
  - [x] åŸºäºå¼€å‘å·¥ä½œæµçš„ç¯å¢ƒé…ç½® [Source: architecture/development-workflow.md#prerequisites]

- [x] **Task 7: ç¼–å†™ä»£ç éƒ¨ç½²ç« èŠ‚** (AC: 7)
  - [x] ç¼–å†™å…‹éš†ä»£ç æ­¥éª¤
    ```bash
    git clone <repository-url>
    cd websocket-relay-platform
    ```
  - [x] ç¼–å†™å®‰è£…ä¾èµ–æ­¥éª¤
    ```bash
    pnpm install
    ```
  - [x] ç¼–å†™æ„å»ºå‰åç«¯æ­¥éª¤
    ```bash
    pnpm build
    ```
  - [x] è¯´æ˜æ„å»ºäº§ç‰©ä½ç½®:
    - å‰ç«¯: `packages/frontend/dist/`
    - åç«¯: `packages/backend/dist/`
  - [x] åŸºäºéƒ¨ç½²æ¶æ„çš„æ„å»ºæµç¨‹ [Source: architecture/deployment-architecture.md#deployment-strategy]

- [x] **Task 8: ç¼–å†™ç¯å¢ƒå˜é‡é…ç½®ç« èŠ‚** (AC: 7)
  - [x] è¯´æ˜å¦‚ä½•åˆ›å»º `.env` æ–‡ä»¶
    ```bash
    cp .env.production .env
    # ç¼–è¾‘ .env å¡«å…¥å®é™…é…ç½®
    ```
  - [x] åˆ—å‡ºæ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡åŠè¯´æ˜:
    - `NODE_ENV=production`
    - `DATABASE_URL` (MySQL è¿æ¥å­—ç¬¦ä¸²)
    - `JWT_SECRET` (å¼ºå¯†é’¥ï¼Œè‡³å°‘ 32 å­—ç¬¦)
    - `JWT_EXPIRES_IN` (Token æœ‰æ•ˆæœŸï¼Œé»˜è®¤ 7d)
    - `API_PORT=3000`
    - `WS_PORT=3001`
    - `ALLOWED_ORIGINS` (ç”Ÿäº§åŸŸåï¼ŒHTTPS)
    - `WS_BASE_URL` (ç”Ÿäº§ WebSocket URLï¼ŒWSS)
    - `LOG_LEVEL=info`
  - [x] å¼ºè°ƒå®‰å…¨æ³¨æ„äº‹é¡¹:
    - ä¿®æ”¹ `JWT_SECRET` ä¸ºå¼ºéšæœºå­—ç¬¦ä¸²
    - ä½¿ç”¨å¼ºæ•°æ®åº“å¯†ç 
    - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ HTTPS/WSS
  - [x] åŸºäºå¼€å‘å·¥ä½œæµçš„ç¯å¢ƒå˜é‡è§„èŒƒ [Source: architecture/development-workflow.md#environment-configuration]

- [x] **Task 9: ç¼–å†™æ•°æ®åº“é…ç½®ç« èŠ‚** (AC: 7)
  - [x] ç¼–å†™åˆ›å»ºæ•°æ®åº“æ­¥éª¤
    ```bash
    mysql -u root -p
    CREATE DATABASE websocket_relay_production CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
    CREATE USER 'ws_user'@'localhost' IDENTIFIED BY 'strong-password';
    GRANT ALL PRIVILEGES ON websocket_relay_production.* TO 'ws_user'@'localhost';
    FLUSH PRIVILEGES;
    EXIT;
    ```
  - [x] ç¼–å†™è¿è¡Œæ•°æ®åº“è¿ç§»æ­¥éª¤
    ```bash
    pnpm --filter backend prisma:migrate
    ```
  - [x] ç¼–å†™ç§å­æ•°æ®æ’å…¥æ­¥éª¤ï¼ˆå¯é€‰ï¼‰
    ```bash
    pnpm --filter backend prisma:seed
    ```
  - [x] è¯´æ˜è¿ç§»æ–‡ä»¶ä½ç½®: `packages/backend/prisma/migrations/`
  - [x] åŸºäºæ•°æ®åº“æ¶æ„æ–‡æ¡£ [Source: architecture/database-schema.md]

- [x] **Task 10: ç¼–å†™ Nginx é…ç½®éƒ¨ç½²ç« èŠ‚** (AC: 7)
  - [x] ç¼–å†™å¤åˆ¶ Nginx é…ç½®æ–‡ä»¶æ­¥éª¤
    ```bash
    sudo cp infrastructure/nginx/nginx.conf /etc/nginx/sites-available/websocket-relay
    ```
  - [x] ç¼–å†™ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„åŸŸåå ä½ç¬¦æ­¥éª¤
    ```bash
    sudo nano /etc/nginx/sites-available/websocket-relay
    # å°† your-domain.com æ›¿æ¢ä¸ºå®é™…åŸŸå
    ```
  - [x] ç¼–å†™åˆ›å»ºç¬¦å·é“¾æ¥æ­¥éª¤
    ```bash
    sudo ln -s /etc/nginx/sites-available/websocket-relay /etc/nginx/sites-enabled/
    ```
  - [x] ç¼–å†™æµ‹è¯•é…ç½®æ­¥éª¤
    ```bash
    sudo nginx -t
    ```
  - [x] ç¼–å†™é‡å¯ Nginx æ­¥éª¤
    ```bash
    sudo systemctl restart nginx
    ```
  - [x] åŸºäºéƒ¨ç½²æ¶æ„çš„ Nginx é…ç½® [Source: architecture/deployment-architecture.md#nginx-configuration]

- [x] **Task 11: ç¼–å†™ Let's Encrypt SSL é…ç½®ç« èŠ‚** (AC: 7)
  - [x] ç¼–å†™å®‰è£… Certbot æ­¥éª¤
    ```bash
    sudo apt-get install certbot python3-certbot-nginx
    ```
  - [x] ç¼–å†™è·å– SSL è¯ä¹¦æ­¥éª¤
    ```bash
    sudo certbot --nginx -d your-domain.com -d www.your-domain.com
    ```
  - [x] ç¼–å†™è‡ªåŠ¨ç»­æœŸæµ‹è¯•æ­¥éª¤
    ```bash
    sudo certbot renew --dry-run
    ```
  - [x] è¯´æ˜è¯ä¹¦è·¯å¾„:
    - è¯ä¹¦: `/etc/letsencrypt/live/your-domain.com/fullchain.pem`
    - ç§é’¥: `/etc/letsencrypt/live/your-domain.com/privkey.pem`
  - [x] åŸºäºæŠ€æœ¯æ ˆçš„ SSL/TLS é…ç½® [Source: architecture/tech-stack.md]

- [x] **Task 12: ç¼–å†™ PM2 å¯åŠ¨ç« èŠ‚** (AC: 7)
  - [x] ç¼–å†™å¯åŠ¨ PM2 è¿›ç¨‹æ­¥éª¤
    ```bash
    pnpm start:prod
    ```
  - [x] ç¼–å†™éªŒè¯è¿›ç¨‹çŠ¶æ€æ­¥éª¤
    ```bash
    pm2 status
    pm2 logs
    ```
  - [x] ç¼–å†™é…ç½® PM2 å¼€æœºè‡ªå¯åŠ¨æ­¥éª¤
    ```bash
    pm2 startup
    pm2 save
    ```
  - [x] è¯´æ˜ PM2 ç®¡ç†å‘½ä»¤:
    - `pm2 restart all` (é‡å¯æ‰€æœ‰è¿›ç¨‹)
    - `pm2 stop all` (åœæ­¢æ‰€æœ‰è¿›ç¨‹)
    - `pm2 logs` (æŸ¥çœ‹æ—¥å¿—)
    - `pm2 monit` (å®æ—¶ç›‘æ§)
  - [x] åŸºäº Story 4.6 çš„ PM2 é…ç½® [Source: docs/stories/4.6.story.md]

- [x] **Task 13: ç¼–å†™éªŒè¯éƒ¨ç½²ç« èŠ‚** (AC: 7)
  - [x] ç¼–å†™éªŒè¯å‰ç«¯è®¿é—®æ­¥éª¤
    ```bash
    curl -I https://your-domain.com
    ```
  - [x] ç¼–å†™éªŒè¯ API è®¿é—®æ­¥éª¤
    ```bash
    curl https://your-domain.com/api/health
    ```
  - [x] ç¼–å†™éªŒè¯ WebSocket è¿æ¥æ­¥éª¤ï¼ˆä½¿ç”¨ wscat æˆ–æµè§ˆå™¨ï¼‰
  - [x] åˆ—å‡ºå¸¸è§é—®é¢˜æ’æŸ¥æ­¥éª¤:
    - æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
    - æ£€æŸ¥ Nginx é”™è¯¯æ—¥å¿—
    - æ£€æŸ¥ PM2 è¿›ç¨‹çŠ¶æ€
    - æ£€æŸ¥æ•°æ®åº“è¿æ¥
  - [x] åŸºäºç›‘æ§å’Œå¯è§‚æµ‹æ€§æ–‡æ¡£ [Source: architecture/monitoring-and-observability.md]

- [x] **Task 14: ç¼–å†™ç»´æŠ¤å’Œæ›´æ–°ç« èŠ‚** (AC: 7)
  - [x] ç¼–å†™ä»£ç æ›´æ–°æµç¨‹
    ```bash
    git pull origin main
    pnpm install
    pnpm build
    pm2 restart all
    ```
  - [x] ç¼–å†™æ•°æ®åº“è¿ç§»æµç¨‹ï¼ˆæœ‰æ–°è¿ç§»æ–‡ä»¶æ—¶ï¼‰
    ```bash
    pnpm --filter backend prisma:migrate
    pm2 restart all
    ```
  - [x] ç¼–å†™å¤‡ä»½å»ºè®®:
    - å®šæœŸå¤‡ä»½æ•°æ®åº“
    - å¤‡ä»½ `.env` æ–‡ä»¶
    - å¤‡ä»½ Nginx é…ç½®
  - [x] ç¼–å†™æ—¥å¿—ç®¡ç†å»ºè®®:
    - å®šæœŸæ¸…ç† `logs/` ç›®å½•
    - ä½¿ç”¨ logrotate ç®¡ç†æ—¥å¿—æ–‡ä»¶
  - [x] åŸºäºéƒ¨ç½²æ¶æ„çš„ç»´æŠ¤æµç¨‹ [Source: architecture/deployment-architecture.md]

- [x] **Task 15: ç¼–å†™å®‰å…¨å»ºè®®ç« èŠ‚** (AC: 5, 7)
  - [x] åˆ—å‡ºé˜²ç«å¢™é…ç½®å»ºè®®
    ```bash
    sudo ufw allow 80/tcp
    sudo ufw allow 443/tcp
    sudo ufw allow 22/tcp
    sudo ufw enable
    ```
  - [x] åˆ—å‡º CORS é…ç½®å»ºè®®ï¼ˆå¦‚æœéœ€è¦ï¼‰
  - [x] åˆ—å‡ºå¯†é’¥ç®¡ç†å»ºè®®:
    - å®šæœŸæ›´æ–° `JWT_SECRET`
    - ä½¿ç”¨å¼ºå¯†ç 
    - é™åˆ¶æ•°æ®åº“ç”¨æˆ·æƒé™
  - [x] åˆ—å‡ºç›‘æ§å’Œæ—¥å¿—å»ºè®®:
    - ç›‘æ§å¼‚å¸¸è®¿é—®
    - è®¾ç½®æ—¥å¿—å‘Šè­¦
    - å®šæœŸæ£€æŸ¥ PM2 è¿›ç¨‹çŠ¶æ€
  - [x] åŸºäºå®‰å…¨å’Œæ€§èƒ½æ–‡æ¡£ [Source: architecture/security-and-performance.md#security-requirements]

- [x] **Task 16: æ·»åŠ å¸¸è§é—®é¢˜ FAQ ç« èŠ‚** (AC: 7)
  - [x] æ·»åŠ "å¦‚ä½•æ›´æ–° SSL è¯ä¹¦ï¼Ÿ"é—®é¢˜å’Œç­”æ¡ˆ
  - [x] æ·»åŠ "å¦‚ä½•æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼Ÿ"é—®é¢˜å’Œç­”æ¡ˆ
  - [x] æ·»åŠ "WebSocket è¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ"é—®é¢˜å’Œç­”æ¡ˆ
  - [x] æ·»åŠ "å¦‚ä½•é‡å¯åº”ç”¨ï¼Ÿ"é—®é¢˜å’Œç­”æ¡ˆ
  - [x] æ·»åŠ "å¦‚ä½•å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Ÿ"é—®é¢˜å’Œç­”æ¡ˆ

- [x] **Task 17: ç¼–å†™è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬å¢å¼ºï¼ˆå¯é€‰ï¼‰** (AC: 7)
  - [x] å¢å¼º `infrastructure/scripts/deploy.sh` è„šæœ¬
  - [x] æ·»åŠ å‰ç½®æ£€æŸ¥:
    - æ£€æŸ¥ Node.jsã€pnpmã€MySQL æ˜¯å¦å®‰è£…
    - æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    - æ£€æŸ¥ PM2 æ˜¯å¦å·²å…¨å±€å®‰è£…
  - [x] æ·»åŠ é”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶
  - [x] æ·»åŠ éƒ¨ç½²æ—¥å¿—è¾“å‡º
  - [x] æ·»åŠ éƒ¨ç½²æˆåŠŸ/å¤±è´¥é€šçŸ¥

- [x] **Task 18: æ›´æ–° README.md æ·»åŠ éƒ¨ç½²æ–‡æ¡£é“¾æ¥** (AC: 7, 8)
  - [x] åœ¨ README.md æ·»åŠ "ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"ç« èŠ‚
  - [x] æ·»åŠ æŒ‡å‘ `docs/deployment.md` çš„é“¾æ¥
  - [x] æ·»åŠ å¿«é€Ÿéƒ¨ç½²å‘½ä»¤ç¤ºä¾‹
  - [x] è¯´æ˜éƒ¨ç½²å‰ææ¡ä»¶

## Dev Notes

### å‰ç½®æ•…äº‹å…³é”®æ´å¯Ÿ

**ä» Story 4.6 ç»§æ‰¿çš„åŸºç¡€è®¾æ–½ï¼š** [Source: docs/stories/4.6.story.md]

- âœ… PM2 ç”Ÿæ€ç³»ç»Ÿé…ç½®å·²å®Œæˆ (`infrastructure/pm2/ecosystem.config.js`)
- âœ… é…ç½®äº†ä¸¤ä¸ªè¿›ç¨‹ï¼š`api-server` (ç«¯å£ 3000) å’Œ `ws-server` (ç«¯å£ 3001)
- âœ… `.env.production` ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶å·²åˆ›å»º
- âœ… éƒ¨ç½²è„šæœ¬ `infrastructure/scripts/deploy.sh` å·²åˆ›å»º
- âœ… æ—¥å¿—ç›®å½• `logs/` å·²é…ç½®
- âœ… é¡¹ç›®æ„å»ºæµç¨‹å·²éªŒè¯ï¼ˆ`pnpm build`ï¼‰
- ğŸ“‚ åŸºç¡€è®¾æ–½ç›®å½•ç»“æ„ï¼š`infrastructure/pm2/` å’Œ `infrastructure/scripts/`

**å…³é”®æŠ€æœ¯å†³ç­–ï¼š**

- ä½¿ç”¨ Nginx ä½œä¸º Web æœåŠ¡å™¨å’Œåå‘ä»£ç†ï¼ˆæ¶æ„æ ‡å‡†ï¼‰
- ä½¿ç”¨ Let's Encrypt æä¾›å…è´¹ SSL è¯ä¹¦ï¼ˆè‡ªåŠ¨ç»­æœŸï¼‰
- å‰åç«¯åˆ†ç¦»éƒ¨ç½²ï¼šå‰ç«¯é™æ€æ–‡ä»¶ + åç«¯ API + WebSocket æœåŠ¡å™¨
- Nginx è´Ÿè´£ WebSocket å‡çº§å’Œåå‘ä»£ç†
- ä½¿ç”¨ Gzip å‹ç¼©ä¼˜åŒ–ä¼ è¾“æ€§èƒ½

---

### é¡¹ç›®ç»“æ„å’Œéƒ¨ç½²ç›®å½•ç»„ç»‡

**ç›®æ ‡ç›®å½•ç»“æ„ï¼š** [Source: architecture/unified-project-structure.md]

```
websocket-relay-platform/
â”œâ”€â”€ infrastructure/             # éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ nginx/                  # æœ¬ Story åˆ›å»º
â”‚   â”‚   â”œâ”€â”€ nginx.conf          # Nginx ä¸»é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ nginx.conf.annotated # å¸¦æ³¨é‡Šçš„é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ pm2/                    # Story 4.6 å·²åˆ›å»º
â”‚   â”‚   â””â”€â”€ ecosystem.config.js
â”‚   â””â”€â”€ scripts/                # Story 4.6 å·²åˆ›å»º
â”‚       â””â”€â”€ deploy.sh
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ deployment.md           # æœ¬ Story åˆ›å»º
â”‚   â”œâ”€â”€ prd/
â”‚   â””â”€â”€ architecture/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ frontend/
â”‚   â”‚   â””â”€â”€ dist/               # å‰ç«¯æ„å»ºäº§ç‰©ï¼ˆNginx æ‰˜ç®¡ï¼‰
â”‚   â””â”€â”€ backend/
â”‚       â””â”€â”€ dist/               # åç«¯ç¼–è¯‘äº§ç‰©ï¼ˆPM2 è¿è¡Œï¼‰
â”œâ”€â”€ logs/                       # PM2 æ—¥å¿—è¾“å‡º
â””â”€â”€ .env.production             # Story 4.6 å·²åˆ›å»º
```

---

### Nginx é…ç½®è§„èŒƒ

**Nginx é…ç½®æ¨¡æ¿ï¼š** [Source: architecture/deployment-architecture.md#nginx-configuration]

```nginx
# infrastructure/nginx/nginx.conf
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/websocket-relay/frontend;
        try_files $uri $uri/ /index.html;
    }

    # REST API
    location /api/ {
        proxy_pass http://localhost:3000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # WebSocket
    location /ws/ {
        proxy_pass http://localhost:3001/ws/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }

    # Gzip å‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript;
}
```

**å…³é”®é…ç½®è¯´æ˜ï¼š**

- **HTTP åˆ° HTTPS é‡å®šå‘ï¼š** `return 301 https://$server_name$request_uri;`
- **SSL/TLS é…ç½®ï¼š** ä½¿ç”¨ Let's Encrypt è¯ä¹¦è·¯å¾„
- **å‰ç«¯é™æ€æ–‡ä»¶ï¼š** `root` æŒ‡å‘å‰ç«¯æ„å»ºäº§ç‰©ï¼Œ`try_files` æ”¯æŒ React Router
- **REST API åå‘ä»£ç†ï¼š** `proxy_pass http://localhost:3000/api/`
- **WebSocket åå‘ä»£ç†ï¼š**
  - `proxy_http_version 1.1` (å¿…éœ€)
  - `Upgrade $http_upgrade` (WebSocket å‡çº§)
  - `Connection "upgrade"` (WebSocket å‡çº§)
- **Gzip å‹ç¼©ï¼š** å‹ç¼©æ–‡æœ¬ã€CSSã€JSONã€JavaScript

---

### æŠ€æœ¯æ ˆå’Œéƒ¨ç½²å·¥å…·

**éƒ¨ç½²æŠ€æœ¯æ ˆï¼š** [Source: architecture/tech-stack.md]

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Nginx | 1.24+ | Web æœåŠ¡å™¨å’Œåå‘ä»£ç† |
| Let's Encrypt | - | HTTPS/WSS åŠ å¯†ï¼ˆå…è´¹ SSL è¯ä¹¦ï¼‰ |
| PM2 | 5.x | Node.js è¿›ç¨‹ç®¡ç† |
| Node.js | 20.x LTS | è¿è¡Œç¯å¢ƒ |
| MySQL | 8.0+ | æ•°æ®åº“ |
| pnpm | 8.x | åŒ…ç®¡ç†å™¨ |

**Nginx ç‰¹æ€§ï¼š**

- é™æ€æ–‡ä»¶æ‰˜ç®¡ï¼ˆé«˜æ€§èƒ½ï¼‰
- åå‘ä»£ç†ï¼ˆAPI å’Œ WebSocketï¼‰
- SSL ç»ˆæ­¢ï¼ˆHTTPS/WSSï¼‰
- Gzip å‹ç¼©ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
- HTTP/2 æ”¯æŒï¼ˆ`http2` æ ‡å¿—ï¼‰

**Let's Encrypt ç‰¹æ€§ï¼š**

- å…è´¹ SSL è¯ä¹¦
- è‡ªåŠ¨ç»­æœŸï¼ˆCertbotï¼‰
- æ”¯æŒå¤šåŸŸå
- 90 å¤©æœ‰æ•ˆæœŸï¼ˆè‡ªåŠ¨ç»­æœŸï¼‰

---

### éƒ¨ç½²æµç¨‹å’Œæ­¥éª¤

**å®Œæ•´éƒ¨ç½²æµç¨‹ï¼š** [Source: architecture/deployment-architecture.md#deployment-strategy]

1. **ç¯å¢ƒå‡†å¤‡ï¼š**
   - å®‰è£… Node.js 20.x LTS
   - å®‰è£… pnpm 8.x
   - å®‰è£… MySQL 8.0+
   - å®‰è£… Nginx 1.24+
   - å®‰è£… PM2 5.x

2. **ä»£ç éƒ¨ç½²ï¼š**
   - å…‹éš†ä»£ç ä»“åº“
   - å®‰è£…ä¾èµ– (`pnpm install`)
   - é…ç½®ç¯å¢ƒå˜é‡ (`.env`)
   - è¿è¡Œæ•°æ®åº“è¿ç§» (`pnpm --filter backend prisma:migrate`)
   - æ„å»ºå‰ç«¯ (`pnpm --filter frontend build`)
   - æ„å»ºåç«¯ (`pnpm --filter backend build`)

3. **Nginx é…ç½®ï¼š**
   - å¤åˆ¶ Nginx é…ç½®æ–‡ä»¶åˆ° `/etc/nginx/sites-available/`
   - ä¿®æ”¹åŸŸåå ä½ç¬¦ä¸ºå®é™…åŸŸå
   - åˆ›å»ºç¬¦å·é“¾æ¥åˆ° `/etc/nginx/sites-enabled/`
   - æµ‹è¯•é…ç½® (`nginx -t`)
   - é‡å¯ Nginx (`systemctl restart nginx`)

4. **SSL é…ç½®ï¼š**
   - å®‰è£… Certbot
   - è·å– Let's Encrypt è¯ä¹¦
   - é…ç½®è‡ªåŠ¨ç»­æœŸ

5. **å¯åŠ¨æœåŠ¡ï¼š**
   - å¯åŠ¨ PM2 è¿›ç¨‹ (`pnpm start:prod`)
   - éªŒè¯è¿›ç¨‹çŠ¶æ€ (`pm2 status`)
   - é…ç½®å¼€æœºè‡ªå¯åŠ¨ (`pm2 startup && pm2 save`)

6. **éªŒè¯éƒ¨ç½²ï¼š**
   - è®¿é—®å‰ç«¯ (https://your-domain.com)
   - æµ‹è¯• API (https://your-domain.com/api/health)
   - æµ‹è¯• WebSocket è¿æ¥ (wss://your-domain.com/ws/...)

---

### ç¯å¢ƒå˜é‡é…ç½®

**ç”Ÿäº§ç¯å¢ƒå˜é‡ï¼š** [Source: architecture/development-workflow.md#environment-configuration]

```bash
# .env ç”Ÿäº§ç¯å¢ƒé…ç½®
# æ•°æ®åº“é…ç½®
DATABASE_URL="mysql://ws_user:strong-password@localhost:3306/websocket_relay_production"

# JWT é…ç½®
JWT_SECRET=your-super-secret-key-change-in-production-min-32-chars
JWT_EXPIRES_IN=7d

# æœåŠ¡å™¨ç«¯å£
API_PORT=3000
WS_PORT=3001

# CORS é…ç½®
ALLOWED_ORIGINS=https://your-domain.com,https://www.your-domain.com

# WebSocket URL
WS_BASE_URL=wss://your-domain.com

# æ—¥å¿—é…ç½®
LOG_LEVEL=info

# Node ç¯å¢ƒ
NODE_ENV=production
```

**å…³é”®é…ç½®è¯´æ˜ï¼š**

- `DATABASE_URL`: ç”Ÿäº§æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼ˆéœ€åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·ï¼‰
- `JWT_SECRET`: å¼ºå¯†é’¥ï¼ˆè‡³å°‘ 32 å­—ç¬¦ï¼Œå¿…é¡»ä¿®æ”¹ï¼‰
- `ALLOWED_ORIGINS`: ç”Ÿäº§åŸŸåï¼ˆå¿…é¡»ä½¿ç”¨ HTTPSï¼‰
- `WS_BASE_URL`: ç”Ÿäº§ WebSocket URLï¼ˆå¿…é¡»ä½¿ç”¨ WSSï¼‰
- `LOG_LEVEL=info`: ç”Ÿäº§ç¯å¢ƒæ—¥å¿—çº§åˆ«ï¼ˆå‡å°‘ debug æ—¥å¿—ï¼‰

---

### å®‰å…¨å’Œæ€§èƒ½è€ƒè™‘

**å®‰å…¨è¦æ±‚ï¼š** [Source: architecture/security-and-performance.md#security-requirements]

1. **SSL/TLS åŠ å¯†ï¼š**
   - å¼ºåˆ¶ HTTPS é‡å®šå‘ï¼ˆç¦æ­¢ HTTP è®¿é—®ï¼‰
   - ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦
   - è‡ªåŠ¨ç»­æœŸï¼ˆCertbotï¼‰

2. **CORS é…ç½®ï¼š**
   - ä»…å…è®¸ç”Ÿäº§åŸŸåè®¿é—® API
   - é…ç½® `ALLOWED_ORIGINS` ç¯å¢ƒå˜é‡
   - Nginx å¯é€‰é…ç½® CORS å¤´ï¼ˆå¦‚æœéœ€è¦ï¼‰

3. **CSP Headersï¼š**
   - `default-src 'self'`
   - `connect-src 'self' wss://your-domain.com`

4. **é˜²ç«å¢™é…ç½®ï¼š**
   - å¼€æ”¾ç«¯å£ 80 (HTTP)
   - å¼€æ”¾ç«¯å£ 443 (HTTPS)
   - å¼€æ”¾ç«¯å£ 22 (SSH)
   - å…³é—­ç«¯å£ 3000 å’Œ 3001ï¼ˆä»…æœ¬åœ°è®¿é—®ï¼‰

5. **å¯†é’¥ç®¡ç†ï¼š**
   - ä½¿ç”¨å¼ºéšæœº `JWT_SECRET`ï¼ˆè‡³å°‘ 32 å­—ç¬¦ï¼‰
   - ä½¿ç”¨å¼ºæ•°æ®åº“å¯†ç 
   - å®šæœŸæ›´æ–°å¯†é’¥

**æ€§èƒ½ä¼˜åŒ–ï¼š** [Source: architecture/security-and-performance.md#performance-optimization]

1. **Gzip å‹ç¼©ï¼š**
   - å¯ç”¨ `gzip on`
   - å‹ç¼©æ–‡æœ¬ã€CSSã€JSONã€JavaScript
   - å‡å°‘ä¼ è¾“ä½“ç§¯ï¼ˆçº¦ 70% å‹ç¼©ç‡ï¼‰

2. **é™æ€èµ„æºç¼“å­˜ï¼š**
   - é…ç½® `Cache-Control` å¤´
   - æµè§ˆå™¨ç¼“å­˜é™æ€æ–‡ä»¶
   - å‡å°‘é‡å¤è¯·æ±‚

3. **HTTP/2 æ”¯æŒï¼š**
   - å¯ç”¨ `http2` æ ‡å¿—
   - å¤šè·¯å¤ç”¨
   - å‡å°‘è¿æ¥å¼€é”€

---

### ç¼–ç è§„èŒƒå’Œå‘½åçº¦å®š

**æ–‡ä»¶å‘½åï¼š** [Source: architecture/coding-standards.md#naming-conventions]

- é…ç½®æ–‡ä»¶ï¼š`nginx.conf`, `nginx.conf.annotated`
- æ–‡æ¡£æ–‡ä»¶ï¼š`deployment.md`ï¼ˆä½¿ç”¨ kebab-caseï¼‰
- è„šæœ¬æ–‡ä»¶ï¼š`deploy.sh`ï¼ˆä½¿ç”¨ kebab-caseï¼‰

**ç›®å½•ç»“æ„ï¼š**

- `infrastructure/nginx/`: Nginx é…ç½®ç›®å½•
- `docs/`: æ–‡æ¡£ç›®å½•

---

### ä¾èµ–é¡¹å’Œå®‰è£…

**ç³»ç»Ÿä¾èµ–ï¼ˆç”Ÿäº§æœåŠ¡å™¨ï¼‰ï¼š**

- **Node.js 20.x LTSï¼š**
  ```bash
  curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
  sudo apt-get install -y nodejs
  ```

- **pnpm 8.xï¼š**
  ```bash
  npm install -g pnpm
  ```

- **MySQL 8.0+ï¼š**
  ```bash
  sudo apt-get install mysql-server
  sudo mysql_secure_installation
  ```

- **Nginx 1.24+ï¼š**
  ```bash
  sudo apt-get install nginx
  ```

- **PM2 5.xï¼š**
  ```bash
  npm install -g pm2
  ```

- **Certbot (Let's Encrypt)ï¼š**
  ```bash
  sudo apt-get install certbot python3-certbot-nginx
  ```

**ä¸éœ€è¦é¢å¤–ä¾èµ–ï¼š** æ‰€æœ‰å·¥å…·éƒ½æ˜¯ç³»ç»Ÿçº§å®‰è£…ï¼Œä¸éœ€è¦æ·»åŠ åˆ°é¡¹ç›®ä¾èµ–ä¸­

---

### éªŒè¯æ£€æŸ¥æ¸…å•

**éƒ¨ç½²éªŒè¯æ­¥éª¤ï¼š**

1. âœ… éªŒè¯ Node.js å’Œ pnpm å·²å®‰è£… (`node -v`, `pnpm -v`)
2. âœ… éªŒè¯ MySQL å·²å®‰è£…å¹¶è¿è¡Œ (`mysql --version`, `systemctl status mysql`)
3. âœ… éªŒè¯ Nginx å·²å®‰è£… (`nginx -v`)
4. âœ… éªŒè¯ PM2 å·²å®‰è£… (`pm2 -v`)
5. âœ… éªŒè¯ä»£ç å·²å…‹éš†å¹¶å®‰è£…ä¾èµ–
6. âœ… éªŒè¯ `.env` æ–‡ä»¶å·²é…ç½®
7. âœ… éªŒè¯æ•°æ®åº“å·²åˆ›å»ºå¹¶è¿ç§»æˆåŠŸ
8. âœ… éªŒè¯å‰åç«¯å·²æ„å»º (`packages/frontend/dist/` å’Œ `packages/backend/dist/` å­˜åœ¨)
9. âœ… éªŒè¯ Nginx é…ç½®æ­£ç¡® (`nginx -t`)
10. âœ… éªŒè¯ PM2 è¿›ç¨‹è¿è¡Œæ­£å¸¸ (`pm2 status`)
11. âœ… éªŒè¯ SSL è¯ä¹¦å·²è·å– (`ls /etc/letsencrypt/live/your-domain.com/`)
12. âœ… éªŒè¯å‰ç«¯å¯è®¿é—® (`curl -I https://your-domain.com`)
13. âœ… éªŒè¯ API å¯è®¿é—® (`curl https://your-domain.com/api/health`)
14. âœ… éªŒè¯ WebSocket å¯è¿æ¥ï¼ˆä½¿ç”¨æµè§ˆå™¨æˆ– wscatï¼‰

---

### Testing

**æµ‹è¯•ç­–ç•¥ï¼š** [Source: architecture/testing-strategy.md]

- **æœ¬ Story ä¸æ¶‰åŠå•å…ƒæµ‹è¯•æˆ–é›†æˆæµ‹è¯•**
- **éªŒè¯æ–¹å¼ï¼š** æ‰‹åŠ¨æµ‹è¯•éƒ¨ç½²æµç¨‹å’Œ Nginx é…ç½®
- **æµ‹è¯•å·¥å…·ï¼š** curl, wscat, æµè§ˆå™¨å¼€å‘è€…å·¥å…·

**æµ‹è¯•åœºæ™¯ï¼š**

1. **Nginx é…ç½®æµ‹è¯•ï¼š** è¿è¡Œ `nginx -t` éªŒè¯é…ç½®è¯­æ³•æ­£ç¡®
2. **å‰ç«¯è®¿é—®æµ‹è¯•ï¼š** è®¿é—® `https://your-domain.com` éªŒè¯å‰ç«¯åŠ è½½
3. **API è®¿é—®æµ‹è¯•ï¼š** è°ƒç”¨ `https://your-domain.com/api/health` éªŒè¯ API å“åº”
4. **WebSocket è¿æ¥æµ‹è¯•ï¼š** ä½¿ç”¨æµè§ˆå™¨æˆ– wscat è¿æ¥ `wss://your-domain.com/ws/...`
5. **SSL è¯ä¹¦æµ‹è¯•ï¼š** éªŒè¯ HTTPS è¯ä¹¦æœ‰æ•ˆæ€§
6. **HTTP é‡å®šå‘æµ‹è¯•ï¼š** è®¿é—® `http://your-domain.com` éªŒè¯é‡å®šå‘åˆ° HTTPS

---

### å·²çŸ¥é™åˆ¶å’Œæœªæ¥æ”¹è¿›

**å½“å‰é™åˆ¶ï¼š**

- å•æœåŠ¡å™¨éƒ¨ç½²ï¼ˆMVP é˜¶æ®µï¼‰
- æ—  CDN åŠ é€Ÿï¼ˆé™æ€èµ„æºç›´æ¥ç”± Nginx æ‰˜ç®¡ï¼‰
- æ— è´Ÿè½½å‡è¡¡ï¼ˆå•å®ä¾‹è¿è¡Œï¼‰
- æ— è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ï¼ˆæ‰‹åŠ¨éƒ¨ç½²ï¼‰

**æœªæ¥æ”¹è¿›æ–¹å‘ï¼š**

1. **CDN é›†æˆï¼š** ä½¿ç”¨ Cloudflare æˆ– AWS CloudFront åŠ é€Ÿé™æ€èµ„æº
2. **è´Ÿè½½å‡è¡¡ï¼š** ä½¿ç”¨ Nginx è´Ÿè½½å‡è¡¡å¤šä¸ªåç«¯å®ä¾‹
3. **å®¹å™¨åŒ–éƒ¨ç½²ï¼š** ä½¿ç”¨ Docker å’Œ Docker Compose
4. **CI/CD è‡ªåŠ¨åŒ–ï¼š** ä½¿ç”¨ GitHub Actions å®ç°è‡ªåŠ¨éƒ¨ç½²
5. **ç›‘æ§å’Œå‘Šè­¦ï¼š** é›†æˆ Prometheus + Grafana æˆ– New Relic
6. **æ—¥å¿—èšåˆï¼š** ä½¿ç”¨ ELK Stack æˆ– Loki èšåˆæ—¥å¿—
7. **é›¶åœæœºéƒ¨ç½²ï¼š** ä½¿ç”¨è“ç»¿éƒ¨ç½²æˆ–æ»šåŠ¨æ›´æ–°

---

## Change Log

| Date       | Version | Description               | Author             |
|------------|---------|---------------------------|--------------------|
| 2025-10-29 | 1.0     | åˆå§‹åˆ›å»ºæ•…äº‹ 4.7          | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

**Claude Sonnet 4.5** (claude-sonnet-4-5-20250929)

### Debug Log References

æ— è°ƒè¯•æ—¥å¿—ã€‚æ‰€æœ‰é…ç½®å’Œæ–‡æ¡£åˆ›å»ºå‡ä¸€æ¬¡æ€§æˆåŠŸå®Œæˆã€‚

### Completion Notes List

1. **Nginx é…ç½®æ–‡ä»¶åˆ›å»ºå®Œæˆ**ï¼š
   - åˆ›å»ºäº†ç”Ÿäº§ç¯å¢ƒå¯ç”¨çš„ `infrastructure/nginx/nginx.conf`ï¼ˆ99 è¡Œï¼‰
   - åŒ…å«å®Œæ•´çš„ HTTPâ†’HTTPS é‡å®šå‘ã€SSL/TLS é…ç½®ã€å‰ç«¯é™æ€æ–‡ä»¶æ‰˜ç®¡ã€API åå‘ä»£ç†ã€WebSocket åå‘ä»£ç†ã€Gzip å‹ç¼©ç­‰æ‰€æœ‰å¿…éœ€é…ç½®
   - åˆ›å»ºäº†è¶…è¯¦ç»†æ³¨é‡Šç‰ˆæœ¬ `infrastructure/nginx/nginx.conf.annotated`ï¼ˆ356 è¡Œï¼‰ï¼Œæ¯ä¸ªé…ç½®å—éƒ½æœ‰è¯¦ç»†çš„ä¸­æ–‡è¯´æ˜å’Œæ€§èƒ½è°ƒä¼˜å»ºè®®

2. **éƒ¨ç½²æ–‡æ¡£åˆ›å»ºå®Œæˆ**ï¼š
   - åˆ›å»ºäº†å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å— `docs/deployment.md`ï¼ˆ1276 è¡Œï¼Œè¶…è¿‡ 27KBï¼‰
   - æ–‡æ¡£åŒ…å« 12 ä¸ªä¸»è¦ç« èŠ‚ï¼Œè¦†ç›–ä»æœåŠ¡å™¨è¦æ±‚åˆ°å¸¸è§é—®é¢˜ FAQ çš„æ‰€æœ‰å†…å®¹
   - æ¯ä¸ªéƒ¨ç½²æ­¥éª¤éƒ½æä¾›äº†å¯ç›´æ¥å¤åˆ¶æ‰§è¡Œçš„å‘½ä»¤
   - åŒ…å«è¯¦ç»†çš„é…ç½®è¯´æ˜ã€å®‰å…¨å»ºè®®ã€æ•…éšœæ’æŸ¥æ­¥éª¤ç­‰

3. **æ–‡æ¡£ç« èŠ‚è¦†ç›–**ï¼š
   - âœ… æœåŠ¡å™¨è¦æ±‚ï¼ˆç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿã€å¿…éœ€è½¯ä»¶ã€ç½‘ç»œç«¯å£ï¼‰
   - âœ… ç¯å¢ƒå‡†å¤‡ï¼ˆNode.jsã€pnpmã€MySQLã€Nginxã€PM2ã€Certbot å®‰è£…ï¼‰
   - âœ… ä»£ç éƒ¨ç½²ï¼ˆå…‹éš†ã€ä¾èµ–å®‰è£…ã€æ„å»ºæµç¨‹ï¼‰
   - âœ… ç¯å¢ƒå˜é‡é…ç½®ï¼ˆå®Œæ•´çš„ `.env` ç¤ºä¾‹å’Œå®‰å…¨æœ€ä½³å®è·µï¼‰
   - âœ… æ•°æ®åº“é…ç½®ï¼ˆåˆ›å»ºæ•°æ®åº“ã€ç”¨æˆ·æˆæƒã€è¿è¡Œè¿ç§»ï¼‰
   - âœ… Nginx é…ç½®éƒ¨ç½²ï¼ˆæ–‡ä»¶å¤åˆ¶ã€åŸŸåæ›¿æ¢ã€ç¬¦å·é“¾æ¥ã€æµ‹è¯•ï¼‰
   - âœ… SSL è¯ä¹¦é…ç½®ï¼ˆLet's Encrypt è‡ªåŠ¨åŒ–é…ç½®å’Œç»­æœŸï¼‰
   - âœ… PM2 å¯åŠ¨æœåŠ¡ï¼ˆè¿›ç¨‹å¯åŠ¨ã€çŠ¶æ€ç›‘æ§ã€å¼€æœºè‡ªå¯åŠ¨ï¼‰
   - âœ… éªŒè¯éƒ¨ç½²ï¼ˆå‰ç«¯ã€APIã€WebSocket è¿æ¥æµ‹è¯•ï¼‰
   - âœ… ç»´æŠ¤å’Œæ›´æ–°ï¼ˆä»£ç æ›´æ–°ã€æ•°æ®åº“è¿ç§»ã€å¤‡ä»½ã€æ—¥å¿—ç®¡ç†ï¼‰
   - âœ… å®‰å…¨å»ºè®®ï¼ˆé˜²ç«å¢™ã€å¯†é’¥ç®¡ç†ã€CORS é…ç½®ã€ç›‘æ§å»ºè®®ï¼‰
   - âœ… å¸¸è§é—®é¢˜ FAQï¼ˆ10 ä¸ªå¸¸è§é—®é¢˜å’Œè¯¦ç»†è§£ç­”ï¼‰

4. **README.md æ›´æ–°å®Œæˆ**ï¼š
   - æ›´æ–°äº†æ–‡æ¡£ç« èŠ‚ï¼Œæ·»åŠ äº†æŒ‡å‘ `docs/deployment.md` çš„é“¾æ¥
   - ä½¿ç”¨ emoji å’Œæ ¼å¼åŒ–æå‡å¯è¯»æ€§

5. **é…ç½®ç‰¹æ€§**ï¼š
   - **å®‰å…¨æ€§**ï¼šå¼ºåˆ¶ HTTPSã€å®‰å…¨å¤´ï¼ˆX-Frame-Optionsã€CSP ç­‰ï¼‰ã€SSL/TLS æœ€ä½³å®è·µ
   - **æ€§èƒ½ä¼˜åŒ–**ï¼šGzip å‹ç¼©ã€é™æ€èµ„æºç¼“å­˜ã€HTTP/2 æ”¯æŒ
   - **WebSocket æ”¯æŒ**ï¼šæ­£ç¡®çš„å‡çº§å¤´é…ç½®ã€é•¿è¿æ¥è¶…æ—¶è®¾ç½®ï¼ˆ7 å¤©ï¼‰
   - **ç”Ÿäº§å°±ç»ª**ï¼šæ‰€æœ‰é…ç½®å‡åŸºäºç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ

### File List

**æ–°å¢æ–‡ä»¶ï¼š**
- `infrastructure/nginx/nginx.conf` - Nginx ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶
- `infrastructure/nginx/nginx.conf.annotated` - å¸¦è¯¦ç»†æ³¨é‡Šçš„ Nginx é…ç½®æ–‡ä»¶
- `docs/deployment.md` - å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `README.md` - æ›´æ–°æ–‡æ¡£ç« èŠ‚ï¼Œæ·»åŠ éƒ¨ç½²æ–‡æ¡£é“¾æ¥

## QA Results

_å¾… QA ä»£ç†å¡«å†™_
