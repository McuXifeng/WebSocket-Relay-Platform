# Story 5.7: 文档重构 - 拆分用户使用说明和二次开发说明

## Status

**Done**

## Story

**As a** 平台用户（网页用户和 API 开发者）,
**I want** 访问清晰分类的文档（用户使用说明 = 纯网页操作指南 vs 二次开发说明 = 使用平台 API 开发自己应用的指南）,
**so that** 我可以根据自己的角色（只用网页的用户 或 使用 WebSocket/REST API 的开发者）快速找到所需信息，而不必在混合内容的单一文档中查找，提升学习效率和文档可用性。

## Acceptance Criteria

1. **创建用户使用说明文档（user-guide.md）**:
   - 在 `docs/` 目录下创建 `user-guide.md` 文件
   - **文档定位**：面向只使用网页界面的用户，不涉及任何代码编写
   - 包含以下章节：
     - **快速开始**：注册登录、通过网页创建端点、查看端点详情（纯网页操作，3 步即可完成）
     - **平台功能介绍**：
       - 端点管理（创建、查看、编辑、删除端点）
       - 实时统计（当前连接数、历史总连接数、总消息数）
       - 设备管理（查看连接设备列表、编辑设备名称）
     - **管理员功能**（仅管理员可见）：
       - 邀请码管理（生成、查看、导出授权码）
       - 用户管理（查看所有用户、查看用户端点）
     - **基本概念**：
       - 什么是端点？（消息中继通道）
       - 端点隔离（不同端点完全隔离）
       - WebSocket URL（系统自动生成，可直接复制使用）
     - **常见问题 FAQ**：
       - 如何修改端点名称？
       - 如何删除端点？
       - 如何查看端点的历史消息？
       - 如何邀请其他用户注册？（管理员）
       - 如何查看所有用户的端点？（管理员）
   - 语言风格简洁友好，面向非技术背景用户
   - **不包含任何代码示例**（所有操作都是网页点击）

2. **创建二次开发说明文档（developer-guide.md）**:
   - 在 `docs/` 目录下创建 `developer-guide.md` 文件
   - **文档定位**：面向使用平台提供的 API（WebSocket + REST API）来开发自己应用的开发者
   - 包含以下章节：
     - **平台概述**：
       - 什么是 WebSocket Relay Platform？（消息中继服务）
       - 典型使用场景（聊天室、多人游戏、协作工具、IoT 设备通信）
     - **WebSocket API 使用说明**：
       - WebSocket URL 格式说明（`ws://域名:端口/ws/{端点ID}`）
       - 消息中继机制（广播模式、端点隔离、不回显）
       - 设备标识协议（可选，用于在管理界面识别设备）
       - 消息格式建议（推荐使用 JSON 格式）
     - **REST API 参考**：
       - 认证 API（POST /api/auth/register, POST /api/auth/login）
       - 端点管理 API（POST /api/endpoints, GET /api/endpoints, DELETE /api/endpoints/:id）
       - 请求/响应格式、状态码、错误处理
     - **客户端连接示例**：
       - 浏览器 JavaScript（完整示例）
       - Node.js（完整示例）
       - Python（可选，简要示例）
     - **消息格式和协议**：
       - 推荐的 JSON 消息格式
       - 设备标识消息格式（`{ type: "identify", deviceId, deviceName }`）
     - **错误处理和最佳实践**：
       - 连接失败处理
       - 自动重连机制
       - 消息队列（连接未建立时暂存消息）
       - 心跳保活（定期发送 ping 消息）
     - **安全建议**：
       - 使用 HTTPS/WSS 加密连接
       - 验证消息来源和格式
       - 防止 XSS 攻击（消息转义）
       - 限制消息大小和频率
     - **完整应用示例**：
       - 简单聊天室（HTML + JavaScript）
       - IoT 设备通信（Node.js）
   - 语言风格技术精确，面向具备开发经验的技术人员
   - **核心内容复用现有 `websocket-usage.md`**（去除网页操作部分，保留所有代码示例和 API 说明）
   - **NOT 包括**：项目源代码修改、数据库 Schema 扩展、后端 API 开发、项目部署指南（这些是项目内部实现，不是 API 使用）

3. **创建前端文档路由和页面组件**:
   - 在 `packages/frontend/src/pages/` 下创建 `UserGuidePage.tsx`（用户使用说明页面）
   - 在 `packages/frontend/src/pages/` 下创建 `DeveloperGuidePage.tsx`（二次开发说明页面）
   - 复用现有的 markdown 渲染逻辑（react-markdown + remark-gfm）
   - 复用 `WebSocketDocPage.tsx` 的侧边栏大纲导航组件和样式文件
   - 根据文档标题（h1, h2, h3）动态生成侧边栏 Anchor 导航项
   - 支持响应式布局（移动端隐藏侧边栏，桌面端显示大纲导航）
   - `DeveloperGuidePage.tsx` 需要实现动态域名替换逻辑（ws://localhost:3001 → 实际部署域名）

4. **更新路由配置（router.tsx）**:
   - 添加路由 `/docs/user` → 渲染 `UserGuidePage` 组件（使用 ProtectedRoute 保护）
   - 添加路由 `/docs/developer` → 渲染 `DeveloperGuidePage` 组件（使用 ProtectedRoute 保护）
   - 设置 `/docs` 默认重定向到 `/docs/user`（用户文档优先）
   - **移除现有的 `/docs/websocket-usage` 路由**（完全替换，不保留向后兼容）

5. **更新导航菜单（MainLayout）**:
   - 在 MainLayout 的导航菜单中添加"文档"下拉菜单（或独立菜单项）
   - 下拉菜单包含两个选项：
     - "用户使用说明" → 跳转到 `/docs/user`
     - "二次开发说明" → 跳转到 `/docs/developer`
   - 使用 Ant Design Menu 组件的 SubMenu 实现
   - 使用 BookOutlined 或 FileTextOutlined 图标
   - 移动端导航抽屉同样支持文档菜单

6. **删除现有文档和路由，完全替换**:
   - 删除现有的 `docs/websocket-usage.md` 文件
   - 删除现有的 `packages/frontend/src/pages/WebSocketDocPage.tsx` 组件
   - 删除现有的 `packages/frontend/src/pages/WebSocketDocPage.css` 样式文件（或复制为新文档页面使用）
   - 从 `router.tsx` 中移除 `/docs/websocket-usage` 路由
   - 确保所有引用旧文档的地方都已更新

7. **测试验证**:
   - 手动测试两个新文档页面的 markdown 渲染正确性
   - 验证侧边栏大纲导航的锚点跳转功能正常
   - 测试响应式布局在移动端和桌面端的展示效果
   - 验证路由跳转和默认重定向行为正确
   - 检查导航菜单的下拉菜单显示和跳转功能
   - 回归测试：验证旧的 `/docs/websocket-usage` 路由已被正确移除（访问时应重定向或显示 404）
   - 验证其他页面（Dashboard、Endpoint Detail）的路由和导航正常

## Tasks / Subtasks

- [x] **Task 1: 编写用户使用说明文档（user-guide.md）** (AC: 1)
  - [ ] 创建 `docs/user-guide.md` 文件
  - [ ] 编写"快速开始"章节（注册登录、通过网页创建端点、查看端点详情）
  - [ ] 编写"平台功能介绍"章节：
    - [ ] 端点管理（创建、查看、编辑、删除）
    - [ ] 实时统计（当前连接数、历史总连接数、总消息数）
    - [ ] 设备管理（查看设备列表、编辑设备名称）
  - [ ] 编写"管理员功能"章节：
    - [ ] 邀请码管理（生成、查看、导出授权码）
    - [ ] 用户管理（查看所有用户、查看用户端点）
  - [ ] 编写"基本概念"章节（什么是端点、端点隔离、WebSocket URL）
  - [ ] 编写"常见问题 FAQ"章节（网页操作相关问题）
  - [ ] 语言风格简洁友好，**不包含任何代码示例**
  - [ ] 所有操作都是网页点击操作的截图说明或步骤描述

- [x] **Task 2: 编写二次开发说明文档（developer-guide.md）** (AC: 2)
  - [ ] 创建 `docs/developer-guide.md` 文件
  - [ ] 编写"平台概述"章节（什么是 WebSocket Relay Platform、典型使用场景）
  - [ ] 编写"WebSocket API 使用说明"章节：
    - [ ] WebSocket URL 格式说明（复用 websocket-usage.md）
    - [ ] 消息中继机制（复用 websocket-usage.md）
    - [ ] 设备标识协议（复用 websocket-usage.md）
    - [ ] 消息格式建议（复用 websocket-usage.md）
  - [ ] 编写"REST API 参考"章节（新增内容）：
    - [ ] 认证 API（注册、登录）
    - [ ] 端点管理 API（创建、查询、删除）
    - [ ] 请求/响应格式、状态码、错误处理
  - [ ] 编写"客户端连接示例"章节（复用 websocket-usage.md）：
    - [ ] 浏览器 JavaScript（完整示例）
    - [ ] Node.js（完整示例）
  - [ ] 编写"消息格式和协议"章节（复用 websocket-usage.md）
  - [ ] 编写"错误处理和最佳实践"章节（复用 websocket-usage.md）：
    - [ ] 连接失败处理
    - [ ] 自动重连机制
    - [ ] 消息队列
    - [ ] 心跳保活
  - [ ] 编写"安全建议"章节（复用 websocket-usage.md）：
    - [ ] HTTPS/WSS 使用
    - [ ] 消息验证
    - [ ] XSS 防护
    - [ ] 频率限制
  - [ ] 编写"完整应用示例"章节（复用 websocket-usage.md）：
    - [ ] 简单聊天室（HTML + JavaScript）
    - [ ] IoT 设备通信（Node.js）
  - [ ] **复用 websocket-usage.md 中的所有代码示例和技术说明**

- [x] **Task 3: 创建用户使用说明前端页面组件** (AC: 3)
  - [ ] 创建 `packages/frontend/src/pages/UserGuidePage.tsx`
  - [ ] 导入 `docs/user-guide.md?raw`（Vite 支持）
  - [ ] 复用 `WebSocketDocPage.tsx` 的 markdown 渲染逻辑（ReactMarkdown + remarkGfm）
  - [ ] 根据文档标题（h1, h2, h3）动态生成侧边栏 Anchor 导航项
  - [ ] 添加平滑滚动和锚点跳转功能
  - [ ] 实现响应式布局（移动端隐藏侧边栏）
  - [ ] 复用现有的文档样式文件（重命名为 `DocPage.css`）
  - [ ] **用户文档不需要动态域名替换**（不涉及代码）

- [x] **Task 4: 创建二次开发说明前端页面组件** (AC: 3)
  - [ ] 创建 `packages/frontend/src/pages/DeveloperGuidePage.tsx`
  - [ ] 导入 `docs/developer-guide.md?raw`
  - [ ] 复用 `WebSocketDocPage.tsx` 的 markdown 渲染逻辑
  - [ ] **实现动态域名替换逻辑**（ws://localhost:3001 → 实际部署域名）：
    ```typescript
    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    const wsPort = window.location.protocol === 'https:' ? '' : ':3001';
    const wsHost = window.location.hostname;
    const wsUrl = `${wsProtocol}//${wsHost}${wsPort}`;
    content = content.replace(/ws:\/\/localhost:3001/g, wsUrl);
    ```
  - [ ] 根据文档标题动态生成侧边栏 Anchor 导航项
  - [ ] 添加代码块语法高亮支持（react-markdown 默认支持）
  - [ ] 实现响应式布局
  - [ ] 复用现有的文档样式文件（重命名为 `DocPage.css`）

- [x] **Task 5: 更新路由配置（router.tsx）** (AC: 4)
  - [ ] 在 `packages/frontend/src/router.tsx` 中导入 `UserGuidePage` 和 `DeveloperGuidePage`
  - [ ] 添加路由 `/docs/user` → 渲染 `UserGuidePage`（使用 ProtectedRoute 保护）
  - [ ] 添加路由 `/docs/developer` → 渲染 `DeveloperGuidePage`（使用 ProtectedRoute 保护）
  - [ ] 添加路由重定向：`/docs` → `/docs/user`（使用 Navigate 组件）
  - [ ] **移除现有的 `/docs/websocket-usage` 路由和 `WebSocketDocPage` 导入**
  - [ ] 运行 `pnpm --filter @websocket-relay/frontend dev`，验证路由配置正确

- [x] **Task 6: 更新导航菜单（MainLayout）** (AC: 5)
  - [ ] 修改 `packages/frontend/src/components/layout/MainLayout.tsx`
  - [ ] 在导航菜单中添加"文档"下拉菜单（使用 Ant Design Menu.SubMenu）
  - [ ] 下拉菜单包含两个菜单项：
    - "用户使用说明" → `/docs/user`
    - "二次开发说明" → `/docs/developer`
  - [ ] 使用 BookOutlined 或 FileTextOutlined 图标
  - [ ] 确保移动端导航抽屉同样支持文档菜单
  - [ ] 当前路由匹配时，高亮显示菜单项（Ant Design Menu 自动处理）

- [x] **Task 7: 删除现有文档和组件** (AC: 6)
  - [ ] 删除 `docs/websocket-usage.md` 文件
  - [ ] 删除 `packages/frontend/src/pages/WebSocketDocPage.tsx` 组件
  - [ ] **备份或重命名** `packages/frontend/src/pages/WebSocketDocPage.css` 为 `DocPage.css`（供新文档页面复用）
  - [ ] 从 `router.tsx` 中移除 `/docs/websocket-usage` 路由和相关导入
  - [ ] 检查项目中是否有其他地方引用了旧文档路径，如有则更新为新路径

- [x] **Task 8: 代码质量检查和测试** (AC: 7)
  - [ ] 运行 ESLint 和 Prettier，确保代码风格一致
  - [ ] 运行 TypeScript 类型检查，修复所有类型错误
  - [ ] 前端 dev server 运行正常，无编译错误
  - [ ] 手动测试 `/docs/user` 页面：
    - markdown 渲染正确
    - 侧边栏导航锚点跳转功能正常
    - 响应式布局在移动端和桌面端展示正确
  - [ ] 手动测试 `/docs/developer` 页面（同上）
  - [ ] 验证路由 `/docs` 重定向到 `/docs/user`
  - [ ] 验证导航菜单的"文档"下拉菜单显示和跳转功能
  - [ ] 回归测试：验证旧的 `/docs/websocket-usage` 路由已被移除（访问时应重定向到 `/docs/user` 或显示 404）
  - [ ] 验证其他页面（Dashboard、Endpoint Detail）的路由和导航正常

## Dev Notes

### 前置故事关键洞察

**当前文档系统实现概述：** [Source: packages/frontend/src/pages/WebSocketDocPage.tsx]

- ✅ **现有实现**：使用 `react-markdown` + `remark-gfm` 渲染 markdown 文件
- ✅ **侧边栏导航**：使用 Ant Design Anchor 组件实现大纲导航，支持锚点跳转
- ✅ **响应式布局**：使用 Ant Design Grid 系统（Row + Col），移动端隐藏侧边栏
- ✅ **动态域名替换**：根据部署环境（开发/生产）动态替换 WebSocket URL
- ⚠️ **需要改进**：现有文档 `websocket-usage.md` 混合了网页操作说明和 API 开发说明，不利于不同角色的用户查找信息

**关键改进方向：**

1. **文档内容拆分**：
   - **用户使用说明（user-guide.md）**：面向只使用网页界面的用户，不涉及任何代码
   - **二次开发说明（developer-guide.md）**：面向使用平台 API（WebSocket + REST API）开发自己应用的开发者
2. **复用渲染逻辑**：创建两个新页面组件，复用现有的 markdown 渲染逻辑
3. **路由和导航扩展**：添加新路由和导航菜单项，保持现有文档页面的向后兼容

---

### 技术栈和依赖

[Source: docs/architecture/tech-stack.md]

| 技术 | 版本 | 用途 | 备注 |
|------|------|------|------|
| **React** | 18.2+ | 前端 UI 框架 | 组件化开发，支持 React Router 路由管理 |
| **Ant Design** | 5.x | UI 组件库 | 使用 `Menu`, `Anchor`, `Card`, `Grid` 组件 |
| **react-markdown** | 9.x | Markdown 渲染库 | 支持 GitHub Flavored Markdown |
| **remark-gfm** | 4.x | GFM 插件 | 支持表格、代码块、自动链接等 |
| **React Router** | 6.x | 前端路由管理 | 创建新路由和重定向 |
| **Vite** | 5.x | 前端构建工具 | 支持 `?raw` 导入 markdown 文件 |

**不需要新增依赖：** 所有功能使用现有技术栈即可实现

---

### 文档结构和内容规划

[Source: docs/prd/epic-5-UI优化与功能增强.md, docs/websocket-usage.md]

**用户使用说明（user-guide.md）内容规划：**

- **目标受众：** 只使用网页界面的用户（不写任何代码）
- **语言风格：** 简洁友好，避免技术术语
- **核心内容：**
  - **快速开始**：
    - 步骤 1: 注册并登录（访问首页 → 点击注册 → 填写表单 → 登录）
    - 步骤 2: 创建端点（进入 Dashboard → 点击"创建端点"按钮 → 输入端点名称 → 确定）
    - 步骤 3: 查看端点详情（点击端点卡片 → 查看 WebSocket URL、统计数据、连接设备）
  - **平台功能介绍**：
    - 端点管理（创建、查看、编辑、删除端点）
    - 实时统计（当前连接数、历史总连接数、总消息数）
    - 设备管理（查看连接设备列表、编辑设备名称）
  - **管理员功能**（仅管理员可见）：
    - 邀请码管理（生成授权码、查看授权码列表、导出 CSV/JSON）
    - 用户管理（查看所有用户、查看用户的端点列表）
  - **基本概念**：
    - 什么是端点？（消息中继通道，同一端点下的客户端可以互相通信）
    - 端点隔离（不同端点之间完全隔离）
    - WebSocket URL（系统自动生成，可直接复制给开发者使用）
  - **常见问题 FAQ**：
    - 如何修改端点名称？（进入端点详情页 → 点击编辑按钮）
    - 如何删除端点？（进入端点详情页 → 点击删除按钮）
    - 如何查看端点的历史消息？（暂不支持，消息不持久化存储）
    - 如何邀请其他用户注册？（管理员：进入邀请码管理页面 → 生成授权码 → 分享给用户）
    - 如何查看所有用户的端点？（管理员：进入用户管理页面 → 点击用户的端点数量）
- **不包含**：任何代码示例、API 调用、WebSocket 连接代码

**二次开发说明（developer-guide.md）内容规划：**

- **目标受众：** 使用平台 API（WebSocket + REST API）开发自己应用的开发者
- **语言风格：** 技术精确，详细完整
- **核心内容（复用 websocket-usage.md）：**
  - **平台概述**：
    - 什么是 WebSocket Relay Platform？（消息中继服务）
    - 典型使用场景（聊天室、多人游戏、协作工具、IoT 设备通信）
  - **WebSocket API 使用说明**：
    - WebSocket URL 格式（`ws://域名:端口/ws/{端点ID}` 或 `wss://域名/ws/{端点ID}`）
    - 消息中继机制（广播模式、端点隔离、不回显）
    - 设备标识协议（可选，`{ type: "identify", deviceId, deviceName }`）
    - 消息格式建议（推荐使用 JSON 格式）
  - **REST API 参考**（新增内容）：
    - **认证 API**：
      - `POST /api/auth/register`（注册新用户）
      - `POST /api/auth/login`（用户登录，返回 JWT Token）
    - **端点管理 API**：
      - `POST /api/endpoints`（创建新端点，需要 JWT Token）
      - `GET /api/endpoints`（查询当前用户的所有端点）
      - `DELETE /api/endpoints/:id`（删除指定端点）
    - 请求/响应格式、状态码、错误处理
  - **客户端连接示例**（复用 websocket-usage.md）：
    - 浏览器 JavaScript（完整示例）
    - Node.js（完整示例）
  - **消息格式和协议**（复用 websocket-usage.md）：
    - 推荐的 JSON 消息格式
    - 设备标识消息格式
  - **错误处理和最佳实践**（复用 websocket-usage.md）：
    - 连接失败处理
    - 自动重连机制
    - 消息队列（连接未建立时暂存消息）
    - 心跳保活（定期发送 ping 消息）
  - **安全建议**（复用 websocket-usage.md）：
    - 使用 HTTPS/WSS 加密连接
    - 验证消息来源和格式
    - 防止 XSS 攻击（消息转义）
    - 限制消息大小和频率
  - **完整应用示例**（复用 websocket-usage.md）：
    - 简单聊天室（HTML + JavaScript）
    - IoT 设备通信（Node.js）
- **NOT 包括**：项目源代码修改、数据库 Schema 扩展、后端 API 开发、Nginx 配置、PM2 部署（这些是项目内部实现，不是 API 使用）

---

### 前端组件和路由设计

[Source: docs/architecture/frontend-architecture.md, packages/frontend/src/router.tsx]

**页面组件设计（UserGuidePage.tsx 和 DeveloperGuidePage.tsx）：**

```typescript
// packages/frontend/src/pages/UserGuidePage.tsx
import React from 'react';
import { Typography, Card, Anchor, Row, Col } from 'antd';
import ReactMarkdown from 'react-markdown';
import remarkGfm from 'remark-gfm';
import markdownContent from '../../../../docs/user-guide.md?raw';
import './WebSocketDocPage.css'; // 复用现有样式

const { Title } = Typography;

const UserGuidePage: React.FC = () => {
  // 用户文档不需要动态域名替换（不涉及代码）
  return (
    <div className="websocket-doc-page">
      <Row gutter={24}>
        <Col xs={0} sm={0} md={6} lg={6} xl={5}>
          <div className="doc-anchor-wrapper">
            {/* 侧边栏 Anchor 导航（动态生成） */}
            <Anchor offsetTop={80} targetOffset={80} items={/* 动态生成的导航项 */} />
          </div>
        </Col>
        <Col xs={24} sm={24} md={18} lg={18} xl={19}>
          <Card className="doc-card">
            <Title level={2}>用户使用说明</Title>
            <div className="markdown-content">
              <ReactMarkdown
                remarkPlugins={[remarkGfm]}
                components={{
                  h1({ children, ...props }) {
                    const text = String(children);
                    const id = text.replace(/[\s:：]/g, '-').replace(/-+/g, '-');
                    return <h1 id={id} {...props}>{children}</h1>;
                  },
                  // ... 类似的 h2, h3 自定义组件
                }}
              >
                {markdownContent}
              </ReactMarkdown>
            </div>
          </Card>
        </Col>
      </Row>
    </div>
  );
};

export default UserGuidePage;
```

```typescript
// packages/frontend/src/pages/DeveloperGuidePage.tsx
import React, { useEffect, useState } from 'react';
import { Typography, Card, Anchor, Row, Col } from 'antd';
import ReactMarkdown from 'react-markdown';
import remarkGfm from 'remark-gfm';
import markdownContent from '../../../../docs/developer-guide.md?raw';
import './WebSocketDocPage.css';

const { Title } = Typography;

const DeveloperGuidePage: React.FC = () => {
  const [processedContent, setProcessedContent] = useState<string>('');

  useEffect(() => {
    // 动态替换 WebSocket URL（ws://localhost:3001 → 实际部署域名）
    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    const wsPort = window.location.protocol === 'https:' ? '' : ':3001';
    const wsHost = window.location.hostname;
    const wsUrl = `${wsProtocol}//${wsHost}${wsPort}`;

    let content: string = markdownContent;
    content = content.replace(/ws:\/\/localhost:3001/g, wsUrl);

    setProcessedContent(content);
  }, []);

  return (
    <div className="websocket-doc-page">
      <Row gutter={24}>
        <Col xs={0} sm={0} md={6} lg={6} xl={5}>
          <div className="doc-anchor-wrapper">
            <Anchor offsetTop={80} targetOffset={80} items={/* 动态生成的导航项 */} />
          </div>
        </Col>
        <Col xs={24} sm={24} md={18} lg={18} xl={19}>
          <Card className="doc-card">
            <Title level={2}>二次开发说明</Title>
            <div className="markdown-content">
              <ReactMarkdown
                remarkPlugins={[remarkGfm]}
                components={{
                  h1({ children, ...props }) {
                    const text = String(children);
                    const id = text.replace(/[\s:：]/g, '-').replace(/-+/g, '-');
                    return <h1 id={id} {...props}>{children}</h1>;
                  },
                  // ... 类似的 h2, h3 自定义组件
                }}
              >
                {processedContent}
              </ReactMarkdown>
            </div>
          </Card>
        </Col>
      </Row>
    </div>
  );
};

export default DeveloperGuidePage;
```

**路由配置（router.tsx）：**

```typescript
// packages/frontend/src/router.tsx
import { Navigate } from 'react-router-dom';
import UserGuidePage from './pages/UserGuidePage';
import DeveloperGuidePage from './pages/DeveloperGuidePage';

const router = createBrowserRouter([
  // ... 现有路由
  {
    path: '/',
    element: <MainLayout />,
    children: [
      // ... 现有子路由
      {
        path: 'docs/user',
        element: (
          <ProtectedRoute>
            <UserGuidePage />
          </ProtectedRoute>
        ),
      },
      {
        path: 'docs/developer',
        element: (
          <ProtectedRoute>
            <DeveloperGuidePage />
          </ProtectedRoute>
        ),
      },
      {
        path: 'docs',
        element: <Navigate to="/docs/user" replace />, // 默认重定向到用户文档
      },
      {
        path: 'docs/websocket-usage', // 保留现有路由（向后兼容）
        element: (
          <ProtectedRoute>
            <WebSocketDocPage />
          </ProtectedRoute>
        ),
      },
    ],
  },
]);
```

**导航菜单设计（MainLayout.tsx）：**

```typescript
// packages/frontend/src/components/layout/MainLayout.tsx
import { Menu } from 'antd';
import { BookOutlined } from '@ant-design/icons';
import { Link } from 'react-router-dom';

// 在 Menu 组件中添加"文档"下拉菜单
<Menu.SubMenu key="docs" icon={<BookOutlined />} title="文档">
  <Menu.Item key="docs-user">
    <Link to="/docs/user">用户使用说明</Link>
  </Menu.Item>
  <Menu.Item key="docs-developer">
    <Link to="/docs/developer">二次开发说明</Link>
  </Menu.Item>
</Menu.SubMenu>
```

---

### 编码规范和命名约定

[Source: docs/architecture/coding-standards.md]

| 元素 | 规范 | 示例 |
|------|------|------|
| 页面组件 | PascalCase | `UserGuidePage.tsx`, `DeveloperGuidePage.tsx` |
| 路由路径 | kebab-case | `/docs/user`, `/docs/developer` |
| 文档文件 | kebab-case | `user-guide.md`, `developer-guide.md` |

**关键规范：**

- 组件文件名使用 PascalCase
- 路由路径使用 kebab-case
- 复用现有样式文件（`WebSocketDocPage.css`）
- 使用 TypeScript 类型注解（组件 props、state）

---

### 测试策略

[Source: docs/architecture/testing-strategy.md]

**手动测试（前端 UI）：**

1. ✅ 访问 `/docs/user` 页面，验证 markdown 渲染正确
2. ✅ 点击侧边栏大纲导航，验证锚点跳转功能正常
3. ✅ 调整浏览器窗口大小，验证响应式布局（移动端隐藏侧边栏）
4. ✅ 访问 `/docs/developer` 页面（同上测试）
5. ✅ 访问 `/docs`，验证自动重定向到 `/docs/user`
6. ✅ 点击导航菜单的"文档"下拉菜单，验证菜单项显示和跳转
7. ✅ 访问 `/docs/websocket-usage`，验证现有文档页面仍然可访问

**回归测试：**

- 验证现有的文档渲染逻辑不受影响
- 验证其他页面（Dashboard、Endpoint Detail）的路由和导航正常

**测试环境：**

- 浏览器：Chrome、Firefox、Safari
- 设备：桌面端、移动端（使用浏览器开发者工具模拟）

---

### 向后兼容性和风险管理

**替换策略：**

- 完全删除现有的 `websocket-usage.md`、`WebSocketDocPage.tsx` 和 `/docs/websocket-usage` 路由
- 新文档（`user-guide.md` 和 `developer-guide.md`）完全替换旧文档
- 用户访问旧路径 `/docs/websocket-usage` 时，应重定向到 `/docs/user`（可选实现）

**风险管理：**

- **Primary Risk:** 新文档内容可能遗漏关键信息，影响用户体验
- **Mitigation:**
  - 用户使用说明：新增网页操作步骤，简洁明了
  - 二次开发说明：完整复用 `websocket-usage.md` 中的所有代码示例和技术说明
  - 由 Scrum Master 和 Product Owner 审核文档内容完整性
  - 在测试阶段，让不同角色的用户（网页用户和开发者）试用新文档，收集反馈

**Rollback Plan:**

- 删除新创建的 `user-guide.md` 和 `developer-guide.md` 文件
- 删除新创建的 `UserGuidePage.tsx` 和 `DeveloperGuidePage.tsx` 组件
- 删除新增的路由配置（`/docs/user`, `/docs/developer`）
- 删除导航菜单中的"文档"下拉菜单
- **恢复旧文档：** 从版本控制系统（Git）恢复 `websocket-usage.md`、`WebSocketDocPage.tsx` 和 `/docs/websocket-usage` 路由

---

### 文件路径和项目结构

[Source: docs/architecture/unified-project-structure.md]

**新增文档文件：**

- `docs/user-guide.md` - 用户使用说明（纯网页操作指南）
- `docs/developer-guide.md` - 二次开发说明（使用平台 API 开发自己应用的指南）

**新增前端组件：**

- `packages/frontend/src/pages/UserGuidePage.tsx` - 用户使用说明页面
- `packages/frontend/src/pages/DeveloperGuidePage.tsx` - 二次开发说明页面

**修改文件：**

- `packages/frontend/src/router.tsx` - 添加新路由、重定向，移除旧路由
- `packages/frontend/src/components/layout/MainLayout.tsx` - 添加导航菜单
- `packages/frontend/src/pages/WebSocketDocPage.css` - 重命名为 `DocPage.css`（可选）

**删除文件：**

- `docs/websocket-usage.md` - 旧文档（删除）
- `packages/frontend/src/pages/WebSocketDocPage.tsx` - 旧文档页面组件（删除）

---

## Testing

**测试策略：** 手动测试（前端 UI）

**测试范围：**

1. ✅ 用户使用说明页面（`/docs/user`）渲染正确，侧边栏导航功能正常
2. ✅ 二次开发说明页面（`/docs/developer`）渲染正确，侧边栏导航功能正常
3. ✅ 路由重定向（`/docs` → `/docs/user`）正常工作
4. ✅ 导航菜单的"文档"下拉菜单显示和跳转功能正常
5. ✅ 响应式布局在移动端和桌面端展示正确
6. ✅ 回归测试：旧的 `/docs/websocket-usage` 路由已被移除（访问时应重定向或显示 404）
7. ✅ 回归测试：其他页面（Dashboard、Endpoint Detail）的路由和导航正常

**测试环境：**

- 前端 dev server：`pnpm --filter @websocket-relay/frontend dev`
- 浏览器：Chrome、Firefox（桌面端和移动端模拟）

**测试数据场景：**

1. **用户使用说明页面：** 访问 `/docs/user`，验证快速开始、平台功能、管理员功能、基本概念、常见问题 FAQ 等章节渲染正确
2. **二次开发说明页面：** 访问 `/docs/developer`，验证平台概述、WebSocket API、REST API、客户端连接示例、错误处理、安全建议、完整示例等章节渲染正确
3. **侧边栏导航：** 点击大纲导航项，验证平滑滚动和锚点跳转功能
4. **路由重定向：** 访问 `/docs`，验证自动重定向到 `/docs/user`
5. **导航菜单：** 点击导航栏的"文档"下拉菜单，验证菜单项显示和跳转
6. **旧路由移除：** 访问 `/docs/websocket-usage`，验证路由已被移除（重定向到 `/docs/user` 或显示 404）
7. **回归测试：** 验证其他页面（Dashboard、Endpoint Detail）的路由和导航正常

---

## Change Log

| Date       | Version | Description                                           | Author             |
|------------|---------|-------------------------------------------------------|--------------------|
| 2025-10-29 | 1.0     | 初始创建故事 5.7                                        | Bob (Scrum Master) |
| 2025-10-29 | 1.1     | 修正文档定位：用户使用说明 = 纯网页操作，二次开发说明 = 使用平台 API 开发自己应用 | Bob (Scrum Master) |
| 2025-10-29 | 1.2     | 修改需求：删除旧文档和路由，完全替换（不保留向后兼容）                              | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

无调试日志

### Completion Notes List

- ✅ 成功创建 `user-guide.md` 文档，仅包含纯网页操作指南，不涉及任何代码
- ✅ 成功创建 `developer-guide.md` 文档，完整复用原有 `websocket-usage.md` 中的所有代码示例和技术说明，并新增 REST API 参考部分
- ✅ 成功创建 `UserGuidePage.tsx` 组件，复用现有的 markdown 渲染逻辑，不需要域名替换
- ✅ 成功创建 `DeveloperGuidePage.tsx` 组件，实现动态域名替换逻辑 (ws://localhost:3001 → 实际部署域名)
- ✅ 成功更新路由配置，添加 `/docs/user` 和 `/docs/developer` 路由，并设置 `/docs` 默认重定向到 `/docs/user`
- ✅ 成功更新导航菜单，将"使用文档"改为"文档"下拉菜单，包含"用户使用说明"和"二次开发说明"两个选项
- ✅ 成功删除旧的 `websocket-usage.md` 和 `WebSocketDocPage.tsx` 文件
- ✅ 代码质量检查通过：TypeScript 类型检查无错误，ESLint 检查通过，Prettier 格式化无变化
- ✅ 前端 dev server 成功启动，无编译错误

**关键设计决策：**
- 用户使用说明（user-guide.md）：面向只使用网页界面的用户，不包含任何代码示例
- 二次开发说明（developer-guide.md）：面向使用平台 API 开发应用的开发者，完整保留所有代码示例和技术内容
- 复用现有的 `WebSocketDocPage.css` 样式文件，保持视觉一致性
- 使用 Ant Design `BookOutlined` 图标表示文档菜单

### File List

**新增文件：**
- `docs/user-guide.md` - 用户使用说明文档
- `docs/developer-guide.md` - 二次开发说明文档
- `packages/frontend/src/pages/UserGuidePage.tsx` - 用户使用说明页面组件
- `packages/frontend/src/pages/DeveloperGuidePage.tsx` - 二次开发说明页面组件

**修改文件：**
- `packages/frontend/src/router.tsx` - 添加新路由，移除旧路由
- `packages/frontend/src/components/layout/MainLayout.tsx` - 更新导航菜单

**删除文件：**
- `docs/websocket-usage.md` - 旧文档文件（已删除）
- `packages/frontend/src/pages/WebSocketDocPage.tsx` - 旧文档页面组件（已删除）

## QA Results

_待 QA 代理填写_
